.stance_chart

<!-- <svg font-size="10px" font-family="sans-serif" fill="none" stroke="none" stroke-width="1.5" width="440" height="180">
  <g>
    <rect x="377" y="58.99122807017544" width="60" height="121.00877192982456" fill="rgb(167,158,189)" stroke="rgb(0,0,0)" stroke-width="0.5"/>
    <rect x="317" y="45.719298245614056" width="60" height="134.28070175438594" fill="rgb(167,158,189)" stroke="rgb(0,0,0)" stroke-width="0.5"/>
    <rect x="257" y="119.10526315789474" width="60" height="60.89473684210525" fill="rgb(167,158,189)" stroke="rgb(0,0,0)" stroke-width="0.5"/>
    <rect x="197" y="123.00877192982458" width="60" height="56.99122807017543" fill="rgb(167,158,189)" stroke="rgb(0,0,0)" stroke-width="0.5"/>
    <rect x="137" y="126.13157894736841" width="60" height="53.86842105263158" fill="rgb(167,158,189)" stroke="rgb(0,0,0)" stroke-width="0.5"/>
    <rect x="77" y="5.122807017543863" width="60" height="174.87719298245614" fill="rgb(167,158,189)" stroke="rgb(0,0,0)" stroke-width="0.5"/>
    <rect x="17" y="2" width="60" height="178" fill="rgb(167,158,189)" stroke="rgb(0,0,0)" stroke-width="0.5"/>
  </g>
   <g>
    <text pointer-events="none" y="3" dy=".71em" transform="translate(407, 61.9912)" fill="rgb(255,255,255)" text-anchor="middle" style="font: 11.3596px sans-serif;">15.5%</text>
    <text pointer-events="none" y="3" dy=".71em" transform="translate(347, 48.7193)" fill="rgb(255,255,255)" text-anchor="middle" style="font: 11.5088px sans-serif;">17.2%</text>
    <text pointer-events="none" y="3" dy=".71em" transform="translate(287, 122.105)" fill="rgb(255,255,255)" text-anchor="middle" style="font: 10.6842px sans-serif;">7.8%</text>
    <text pointer-events="none" y="3" dy=".71em" transform="translate(227, 126.009)" fill="rgb(255,255,255)" text-anchor="middle" style="font: 10.6404px sans-serif;">7.3%</text>
    <text pointer-events="none" y="3" dy=".71em" transform="translate(167, 129.132)" fill="rgb(255,255,255)" text-anchor="middle" style="font: 10.6053px sans-serif;">6.9%</text>
    <text pointer-events="none" y="3" dy=".71em" transform="translate(107, 8.12281)" fill="rgb(255,255,255)" text-anchor="middle" style="font: 11.9649px sans-serif;">22.4%</text>
    <text pointer-events="none" y="3" dy=".71em" transform="translate(47, 5)" fill="rgb(255,255,255)" text-anchor="middle" style="font: 12px sans-serif;">22.8%</text>
  </g>

 </svg>
 -->


%script{:type => "text/javascript+protovis"}
  spacing = 0;

  function get_width(){
    //return $j('.vizbase .middle').width() - spacing * 2;
  }
  
  function get_scaler(){
    return Math.max(1, Math.max.apply( Math, proposal_stance_data ));
  }
  
  function get_bar_width(){
    return 60;
    //return get_width() / 7;
  }

  function reset_selected_idx(){
    bar.def('sel', -1);
    bar.render();
  }
    
	// protovis_stance_has_been_rendered is for IE hack
  if ( proposal_stance_data && ( typeof(protovis_stance_has_been_rendered) == "undefined" || protovis_stance_has_been_rendered == false) ) {
    var colors = pv.colors("#AAA", "#999", "#777", 
          "#555", "#777", "#999", "#AAA").range();
    //var colors = pv.colors("#6e577a", "#685977", "#5f5c73", 
    //      "#55606e", "#4c6469", "#436765", "#3d6962").range();
							
		var height = 180;
		
    var vis = new pv.Panel()
        //.width(get_width() + spacing)
        .width(440)
        .height(height);
		
    var bar = vis
		  .add(pv.Bar)
        .data(proposal_stance_data) //counts
        .def("i", -1)
        .def('sel', -1)
        .width( function() get_bar_width() - spacing)
        .left( function() (6 - this.index) * get_bar_width() + 17 )
        .height(function(d) d * (height-2)  / get_scaler() )
        .bottom(0)
        .strokeStyle('black')
        .lineWidth(.5)
        .fillStyle(function(d) this.i() == this.index ? "black" : this.sel() == this.index || this.sel() == -1 ? "#A79EBD" : "#949494")
        .event("mouseover", function() this.i(this.index))
        .event("mouseout", function() this.i(-1))
        .event("click", function(){
          this.sel(this.index);
          ConsiderIt.positions.stance_group_clicked(this.index);
        });

    var label = bar     
      .anchor("top").add(pv.Label)
        .top(function() bar.top() + 3)
        .left(function() bar.left() + bar.width() / 2)
        .textAlign("center")
        .textBaseline("top")
        .textStyle("white")
        .font(function(d) 10 + d * 2 / get_scaler() + "px sans-serif")
        .text(function(d) d + '%'); 
								
		try{
      // does not work in IE
		  //bar.title(function(d) "Click to see the most compelling reasons for people who " + ConsiderIt.positions.stance_name(this.index) + " this measure.");
			ie = false;  
		} catch(err){
		  ie = true;
		}

								
    vis.render();
    
    
    if ( !ie ) {
		
	    $j('.stance_chart a').each(function(){
				$j(this)
				 .attr('title', $j(this).attr('xlink:title'))
				 .attr('xlink:title', "");
				bar.title(function(d) " ");
	      var settings = { 
	          style: {
	            name: 'cream',
	            tip: false
	          }, 
	          position: {
	            target: 'mouse',
	            corner: { 
	              target: 'bottomMiddle', 
	              tooltip: 'topMiddle' 
	            },
	            adjust: {
	              x: 0, y: 30
	            }
	          }
	        };
								
			  $j(this).qtip(settings);

			});
	  }
	  
	  protovis_stance_has_been_rendered = true;
	}
