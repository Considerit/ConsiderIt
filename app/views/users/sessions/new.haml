
%div#login_form

  .primary.fr
    %h2.sub_follows
      - if @context == 'position_submit'
        Log in to save your position
      - else
        Log in to the Living Voters Guide      
    .sub
      Don't have an account?
      %a#register_instead 
        Create account

    #third_party

      %h3
        If you used your account from:

      - ['facebook', 'twitter', 'google', 'yahoo'].each do |provider|
        %a{ :href => "javascript:login('#{new_user_session_path(:third_party=>true, :provider=>"#{provider}")}',500, 500)" }
          = image_tag("#{provider}.png")

    .divider

    #lvg_account
      
      %h3
        Or, if you created an account with us:

      = form_for(resource, :as => resource_name, :url => session_path( resource_name), :html => { :multipart => true }) do |f|
      
        %ul
          %li
            = devise_error_messages!
                      
          %li.email_field
            %label
              email
            = f.email_field :email, :title => 'email address'

          %li.password_field
            %label
              password
            = f.password_field :password, :title => 'password'
        
        .submit_footer
          = f.submit "Login"

          %a.cancel
            cancel

        = link_to "Forgot your password?", new_password_path(resource_name)

  .clear

:javascript
  $j('.has_example').example(function() {
     return $j(this).attr('title'); 
  });

  $j('input[type="submit"]').corner('5px');
  $j('#registration_form .primary, #registration_form .secondary').corner('8px');

  $j('#lvg_account a.cancel').click(function(){
    $j('.user_dialog').dialog('close');
  });

  $j('a#register_instead').click(function(){
    $j('#login_form').load('#{new_user_registration_path(:third_party=>false)}');
  });

  var newWindow;

  function login(provider_url, width, height) {
    var screenX     = typeof window.screenX != 'undefined' ? window.screenX : window.screenLeft,
        screenY     = typeof window.screenY != 'undefined' ? window.screenY : window.screenTop,
        outerWidth  = typeof window.outerWidth != 'undefined' ? window.outerWidth : document.body.clientWidth,
        outerHeight = typeof window.outerHeight != 'undefined' ? window.outerHeight : (document.body.clientHeight - 22),
        left        = parseInt(screenX + ((outerWidth - width) / 2), 10),
        top         = parseInt(screenY + ((outerHeight - height) / 2.5), 10),
        features    = ('width=' + width + ',height=' + height + ',left=' + left + ',top=' + top);

        newwindow = window.open(provider_url, 'Login', features);

    if (window.focus)
      newwindow.focus();

    return false;
  }

