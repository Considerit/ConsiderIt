#!/bin/sh

ASPECT='16:9'
WIDTH=1920
HEIGHT=1080

echo 'BEFORE'
echo getopts ":a:w:h:"
while getopts ":a:w:h:i:" option; do
    case "$option" in
    a) ASPECT=$OPTARG;;
    w) WIDTH=$OPTARG;;
    h) HEIGHT=$OPTARG;;
    i) FILE=$OPTARG;;
    \?) echo "Invalid option: -$OPTARG" >&2;;
    esac
done

# Produce the webm
ffmpeg -an -i lib/screencasts/exports/$FILE.mov -threads 16  -keyint_min 0 -g 250 -skip_threshold 0 -qmin 1 -qmax 51 -vcodec libvpx -b:v 1024000 -s $WIDTH\x$HEIGHT -aspect $ASPECT -y -strict -2 lib/screencasts/exports/$FILE.webm

# Produce the mp4
HandBrakeCLI -a none --optimize --preset 'High Profile' --height $HEIGHT --two-pass --input lib/screencasts/exports/$FILE.mov --output lib/screencasts/exports/$FILE.mp4 --encoder-preset placebo --cfr