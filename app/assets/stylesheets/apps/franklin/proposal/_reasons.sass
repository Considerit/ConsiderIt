//////////////////
// global layout for reasons & points, in different states
@import "compass/css3/animation"

$use_transitions: true



+keyframes(FromTogetherToSeparated_PeerReasons)
  0%
    background-color: whitesmoke
    border-color: darken(whitesmoke, 10%)

  70%
    background-color: whitesmoke
    border-color: whitesmoke

  100%
    background-color: none
    border-color: transparent

+keyframes(FromTogetherToSeparated_PeerPoints)
  0%
    background-color: whitesmoke
    border-color: transparent
    +single-box-shadow($color: rgba(black, 0), $voff: 1px)

  90%
    background-color: whitesmoke
    border-color: transparent
    +single-box-shadow($color: rgba(black, 0), $voff: 1px)

  100%
    +single-box-shadow($color: rgba(black, .1), $voff: 1px)
    background-color: whitesmoke
    border-color: #f1f1f1 #ddd #bbb #ddd

+keyframes(FromTogetherToSeparated_hidden)
  0%
    opacity: 0

  50%
    opacity: 0

  100%
    opacity: 1



// transitions / animations
.m-reasons.transitioning
  +transition(transform $transition_speed $transition_function)
  .m-position-region, .m-aggregated-propoints-region, .m-aggregated-conpoints-region
    +transition(transform $transition_speed $transition_function)

  &[data-state="separated"]
    &[data-state-from="together"], &[data-state-from="collapsed"]
      .m-peer-reasons
        +animation(FromTogetherToSeparated_PeerReasons $transition_speed)

      .m-point-peer.m-point-unexpanded .m-point-wrap
        +animation(FromTogetherToSeparated_PeerPoints $transition_speed)
        +animation-fill-mode(none)

      .m-point-include, .m-pointlist-browse-toggle
        +animation(FromTogetherToSeparated_hidden $transition_speed * 2.5)


.m-reasons  
  &[data-state="separated"], &[data-state="collapsed"]
    +translateY(-$aggregate_area_height)

  &[data-state="separated"][data-state-from="together"]
    +translateY(0)

  &[data-state="separated"][data-state-from="together"]
    .m-position-region
      +translateY(- 2 * $vertical_baseline)

    .m-aggregated-propoints-region, .m-aggregated-conpoints-region
      +translateY($vertical_baseline)

  &[data-state="separated"][data-state-from="collapsed"], &[data-state="separated"]
    .m-position-region
      +translateY(3 * $vertical_baseline)

    .m-aggregated-propoints-region, .m-aggregated-conpoints-region
      +translateY(6 * $vertical_baseline)


  &[data-state="collapsed"]
    .m-position-region
      //bottom: 0
      +translateY($aggregate_area_height + $vertical_baseline)
      //vertical-align: bottom

  .m-aggregated-propoints-region .m-peer-reasons
    border-radius: 16px 0 0 16px
    border-right-color: transparent

  .m-aggregated-conpoints-region .m-peer-reasons
    border-radius: 0 16px 16px 0
    border-left-color: transparent

  // basic layout

  .m-points-list-region, .m-position-region
    display: inline-block

  .m-position-region
    //overflow: hidden
    //visibility: hidden

  .m-reasons-lists
    //height: 100%
    top: 0 
    min-height: $aggregate_area_height
    position: absolute  

  .m-aggregated-propoints-region, .m-aggregated-conpoints-region
    height: 100%
    .m-peer-reasons
      height: 100%

  .m-aggregated-propoints-region

    .m-point-header-region
      float: left

  .m-aggregated-conpoints-region

    .m-point-header-region
      float: right

    .m-point-unexpanded .m-point-header-region
      right: $peer_padding

  &.transitioning .m-personal-reasons
    //min-height: 0
    min-height: 450px

  [data-state="separated"]
    .m-personal-reasons
      min-height: 450px


  //horizontal size and positioning

  .m-reasons-lists
    padding: 0
    width: $full_reasons_width
    left: $full_reasons_left   //-$peer-point-results-width + $margin_width - 2 * $peer-point-avatar-area //- $grid_xs / 4

  .m-point-header-region
    width: $peer-point-avatar-area
    position: relative

  &[data-state="separated"]

    .m-aggregated-propoints-region, .m-aggregated-conpoints-region
      width: $peer-point-width
      //left: 0

    .m-point-peer.m-point-unexpanded
      width: $peer-point-width
      .m-point-wrap
        width: $peer-point-wrap-width

  &[data-state="together"], &[data-state="collapsed"]
    .m-aggregated-propoints-region, .m-aggregated-conpoints-region
      width: $peer-point-results-width

    .m-aggregated-propoints-region
      //left: $peer-point-results-width + 1.5
      +translateX($peer-point-results-width - ($peer-point-results-width - $decision_board_width/2) + 3.5)

    .m-aggregated-conpoints-region
      //left: -$peer-point-results-width - 1.5
      +translateX(-$peer-point-results-width + ($peer-point-results-width - $decision_board_width/2) - 3.5)

    .m-point-peer.m-point-unexpanded 
      width: $peer-point-results-width
      .m-point-wrap
        width: $peer-point-wrap-results-width

  .m-position-propoints-region, .m-position-conpoints-region
    width: $position-point-width

    .m-point-position.m-point-unexpanded 
      width: $position-point-width
      .m-point-wrap
        width: $position-point-wrap-width 



  // pointlist browsing
  &.m-reasons-browsing .m-reasons-lists
    width: $full_reasons_width + $expanded_points_increment

    .m-position-region, .m-position, .m-position-message-body
      height: 100%

  &.m-reasons-browsing-cons .m-reasons-lists
    left: $full_reasons_left - $expanded_points_increment 


  &[data-state="separated"]
    .m-aggregated-propoints-region, .m-aggregated-conpoints-region
      &.m-pointlist-browsing
        width: $peer-point-width + $expanded_points_increment

        .m-point-peer.m-point-unexpanded 
          width: $peer-point-width + $expanded_points_increment
          .m-point-wrap
            width: $peer-point-wrap-width + $expanded_points_increment


  &[data-state="together"]
    .m-aggregated-propoints-region, .m-aggregated-conpoints-region
      &.m-pointlist-browsing
        width: $peer-point-results-width + $expanded_points_increment

        .m-point-peer.m-point-unexpanded
          width: $peer-point-results-width + $expanded_points_increment
          .m-point-wrap
            width: $peer-point-wrap-results-width + $expanded_points_increment


////////// end layout //////////


// Activity-based styles
[data-activity="proposal-no-activity"]
  .m-reasons[data-state="collapsed"] .m-points-list-region
    display: none


[data-activity="proposal-has-activity"]
  .m-reasons[data-state="collapsed"]
    .m-reasons-lists
      min-height: $aggregate_area_height
      //margin-bottom: 100px // spacing for participants block

  .m-reasons
    &[data-state="together"], &[data-state="separated"]
      min-height: 500px

////////////////////


[data-state="0"] .m-proposal-reasons-region
  height: 3 * $vertical_baseline

.m-reasons
  margin: $vertical_baseline 0 4 * $vertical_baseline 0


  &[data-state="collapsed"] .m-aggregated-conpoints-region   
    svg.t-bubble
      left: auto
      right: -23px
      
  &[data-state="separated"], &[data-state="together"], &[data-state="collapsed"] .m-aggregated-propoints-region
    .m-peer-reasons
      > svg.t-bubble
        display: none

  &[data-state="collapsed"]
    .m-points-list-region, .m-participants
      &:hover
        cursor: pointer


  /////////
  // warpper for a points column, managed by a PointsController
  .m-points-list-region
    position: relative
    vertical-align: top

  .m-position-region
    position: relative
    width: $decision_board_width

  .m-aggregated-propoints-region, .m-aggregated-conpoints-region
    //position: absolute
    top: 0
    z-index: 10

  ////////


  /// The participants block
  &[data-state="separated"]
    > .l-message-speaker
      display: none
    .l-group-container
      


  .m-reasons-footer-region
    visibility: hidden

  &[data-state="collapsed"] 
    // shown on hover...
    .m-reasons-footer-region
      width: $margin_width
      position: absolute
      right: $grid_xs / 2
      bottom: - 2 * $vertical_baseline

      div
        text-align: center

      .m-reasons-view-results
        text-align: right
        +font-size(-1)


// sticky footer for results (not presented in .m-reasons el)
.m-reasons-footer-sticky
  text-align: center

  a
    width: 100%
    border-radius: 0
    +font-size(2)

