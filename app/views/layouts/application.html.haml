
!!! Strict
%html{html_attrs}
  %head{ :profile => "http://gmpg.org/xfn/1" }
    = csrf_meta_tags

    - cache ['indexable data', current_tenant, @page] do 
      %title
        = @title && @title != '' ? @title : current_tenant.app_title
      
      %meta{ :name => 'keywords', :content => "#{@keywords ? @keywords : ''}"}

      %meta{ :name => 'description', :content => "#{@description ? @description : ''}"}

    - cache ['main_layout', current_tenant] do 
      %meta{ :content => 'text/html; charset=UTF-8', "http-equiv" => "Content-Type" }

      %meta{ :name => "fragment", :content => "!"}

      %link{ :href => "#{current_theme_image_path 'favicon.ico'}", :rel => "icon", :type => "image/vnd.microsoft.icon" }

      = theme_stylesheet_link_tag 'application'

      - ['Source+Sans+Pro'].each do |font|
        %link{ :href => "//fonts.googleapis.com/css?family=#{font}:400,700,400italic",  :rel => 'stylesheet', :type => 'text/css' }

      /[if IE 9]
        = stylesheet_link_tag 'browser/ie/ie9'
      
      /[if lte IE 8]
        = stylesheet_link_tag 'browser/ie/ie'


      :javascript
        //http://blog.colin-gourlay.com/blog/2012/02/safely-using-ready-before-including-jquery/
        (function(w,d,u){w.readyQ=[];w.bindReadyQ=[];function p(x,y){if(x=="ready"){w.bindReadyQ.push(y);}else{w.readyQ.push(x);}};var a={ready:p,bind:p};w.$=w.jQuery=function(f){if(f===d||f===u){return a}else{p(f)}}})(window,document)

      = render :partial => 'backbone/templates'

      = theme_javascript_include_tag 'application', :async => true


  %body
    / = image_tag "ajax-loader.gif", :style => 'display: none'

    - cache ['main_body', current_tenant] do

      #t-bg
        #t-bg-top
          %svg{ :xmlns => "http://www.w3.org/2000/svg", :height => 0, :style => "position: absolute", :version => "1.1", :baseProfile => "full" }
            %defs
              %filter{ :id => "bubble_gradient"}
                %feImage{ :x => "10", :y => "0", :'xlink:href' => "#{image_path('bubble_gradient.png')}", :result => "overlay" }
                %feOffset{ :dy => ".2", :dx => "0" }  
                %feComposite{ :in2 => "SourceGraphic", :operator => "over" }

          #l-wrap
            #l-loading-indicator
            #l-header
            #l-content

              #l-content-main
                #t-bg-content
                  #t-bg-content-top
                    #l-content-main-wrap
                    #m-dashboard.l-content-wrap

                    = image_tag "ajax-loader.gif", :id => 'l-preloader'

            #l-footer

            - if APP_CONFIG[:analytics][:google] && APP_CONFIG[:analytics][:google] != ''
              :javascript
                var _gaq = _gaq || [];
                _gaq.push(['_setAccount', "#{current_tenant.analytics_google}"]);
                _gaq.push(['_setDomainName', ".#{get_root_domain}"]);
                _gaq.push(['_trackPageview']);


            - if current_tenant.analytics_google && current_tenant.analytics_google != ''
              :javascript
                var _gaq_account = _gaq_account || [];
                _gaq_account.push(['_setAccount', "#{current_tenant.analytics_google}"]);
                _gaq_account.push(['_trackPageview']);

    = render :partial => 'backbone/data'        

    :javascript
      $(function() {
        ConsiderIt.start({
          environment: "#{Rails.env}"
        });

        var $buoop = {vs:{i:8,f:15,o:10.6,s:4,n:9}} ;
        $buoop.ol = window.onload; 
        try {if ($buoop.ol) $buoop.ol();}catch (e) {} 
        var e = document.createElement("script"); 
        e.setAttribute("type", "text/javascript"); 
        e.setAttribute("src", "/browser-update.js"); 
        document.body.appendChild(e); 

      });
