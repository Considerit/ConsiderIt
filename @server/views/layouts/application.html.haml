
- cache ['application_layout', @app, @page, @is_search_bot, current_user.super_admin, current_subdomain] do 

  !!! 5



  %html{ lang: current_subdomain.lang}

    %head{ profile: "http://gmpg.org/xfn/1", prefix: "og: http://ogp.me/ns#"}

      - if @title
        %title
          = @title      

      // oEmbed 
      - if @proposal

        - ['xml', 'json'].each do |format| 
          %link{ :rel => 'alternate', :title => format + " oEmbed Profile", :type => "#{format=='json' ? 'application' : 'text'}/#{format}+oembed", :href => "https://#{@host}/oembed.#{format}?url=#{@oembed_url}"}

      - @meta.each do |meta|
        - if meta[:content]
          %meta{ meta }

      %meta{ :content => 'text/html; charset=UTF-8', "http-equiv" => "Content-Type" }

      %meta{ :name => "app", :content => @app}

      %meta{ :http_equiv => "X-UA-Compatible", :content => "IE=edge,chrome=1" }

      %meta{ :name => "viewport", :content => "width=1152" }

      %meta{ :name => "fragment", :content => "!" }

      %link{ :href => @favicon, :rel => "icon", :type => "image/vnd.microsoft.icon" }

      //ios
      %link{ :rel => "apple-touch-icon", :href => "/apple-touch-icon.png"} 

      //android
      %link{ :rel => "icon", :sizes => "196x196", :href => "/apple-touch-icon.png"} 

      %link{:href => "//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css", :rel => "stylesheet"}

      - if !@is_search_bot
        %link{ :href => "//fast.fonts.net/cssapi/cd97b194-90f2-4567-be7e-3a72011995f3.css",  :rel => 'stylesheet', :type => 'text/css' }

      /[if lte IE 8]
        %script{:type => "text/javascript"}
          window.location = "http://windows.microsoft.com/en-us/internet-explorer/download-ie";

      - if current_subdomain.name == 'RANDOM2015'
        %script{type: "text/javascript", src:"//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"}

      - if @app == 'product_page'
        %script{:src => "/embedding/proposal.js", :type => 'text/javascript'}
        
    %body
      .hidden 
        %a{ :href => 'accessibility_support', :style => 'position:absolute;left:-10000px;' }   
          Accessibility support for considerit   
          
      #content.content{ subdomain: current_subdomain.name }



      :javascript
        //http://stackoverflow.com/questions/7742781/why-javascript-only-works-after-opening-developer-tools-in-ie-once
        if(!window.console) {
          window.console={
            log : function(){},
            assert : function(){},
            info : function(){},
            warn : function(){},
            error : function(){},
            time : function(){},
            timeEnd : function(){}
          }
        }

      %script{:type => 'text/javascript'}
        window.asset_host = '#{Rails.application.config.action_controller.asset_host}'

      %script{:src => @js, :type => 'text/javascript'}


      - if current_user.super_admin
        %script{:src => 'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/codemirror.min.js', :type => 'text/javascript'}
        %script{:src => 'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/mode/coffeescript/coffeescript.js', :type => 'text/javascript'}
        %link{:rel => 'stylesheet', :href => 'https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.17.0/codemirror.min.css'}

      - if @app == 'product_page' && Rails.env.production?
        :javascript

          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-55365750-2', 'auto');
          ga('send', 'pageview');


      %script{:type => 'text/javascript', :src => "//translate.google.com/translate_a/element.js"}


      - if @app == 'franklin'
        // for Facebook social buttons
        #fb-root

        - if current_subdomain.name == 'livingvotersguide'
          :javascript
            (function(d, s, id) {
              var js, fjs = d.getElementsByTagName(s)[0];
              if (d.getElementById(id)) return;
              js = d.createElement(s); js.id = id;
              js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=206466936144360&version=v2.0";
              fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));

        - if Rails.env.production?
          :javascript
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          - if APP_CONFIG[:google_analytics] != ''
            :javascript
              ga('create', '#{APP_CONFIG[:google_analytics]}', 'consider.it', {'name': 'considerit'});
              ga('considerit.send', 'pageview');


          - if current_subdomain.google_analytics_code && current_subdomain.google_analytics_code != ''
            :javascript
              ga('create', '#{current_subdomain.google_analytics_code}', 'auto', {'name': 'customer'});
              ga('customer.send', 'pageview');
