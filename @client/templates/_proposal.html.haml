////////////// proposal ////////////
%script{ :type => "text/template", :id => "tpl_proposal_layout" }  

  .proposal-description-region

  .proposal-state-toggle-region
  
  .proposal-aggregate-region

  .proposal-reasons-region

%script{ :type => "text/template", :id => "tpl_proposal_state_toggle"}

  (( if(crafting) { ))

  .proposal-state-primary
    {{ call }}

  %a{ :href => "{{Routes.proposal_path( long_id )}}", :class => 'proposal-state-secondary', :'data-target' => 'view-results'}
    // %i.fa-lg.fa
    //   &#xf046;

    {{ results_call }}

  (( } else { ))
  .proposal-state-primary
    {{ results_call }}

  %a{ :href => "{{Routes.new_position_proposal_path( long_id )}}", :class => 'proposal-state-secondary', :'data-target' => 'craft-position'}
    // %i.fa-lg.fa
    //   &#xf096;

    {{ call }}


  (( } ))

////////////// position ////////////

%script{ :type => "text/template", :id => "tpl_position_crafting_layout" }  

  .position-message-body.l-message-body
    / %h2.position-heading-points
    /   {{ considerations_prompt }}

    .reasons-header-region

    .position-reasons-region

    .position-stance-region

    .position-explanation-region

  .position-footer-region
              

%script{ :type => "text/template", :id => "tpl_position_reasons" }  

  .position-propoints-region.points-list-region
     
  .position-conpoints-region.points-list-region


%script{ :type => "text/template", :id => "tpl_position_stance" }  
  .position-heading-stance
    {{ slider_prompt }}
  %table
    %tr
      %td.stance-label-support
        %div
          {{ slider_left }}

      %td.stance-slider-container
        .noUiSlider

      %td.stance-label-oppose
        %div
          {{ slider_right }}
    %tr
      %td.stance-label-neutral{ :colspan => 3 }
        {{ slider_middle }}

%script{ :type => "text/template", :id => "tpl_position_explanation" }  
  %label{ :name => :explanation }
    Optional statement that summarizes your thoughts
  %textarea.position-statement{ :name => :explanation}


%script{ :type => "text/template", :id => "tpl_position_footer" }  

  (( if( active ) { ))

  %a.position-your-action-body.submit{:'data-target' => 'submit-position'}
    // fa-floppy-o
    %i.fa-lg.fa.fa-floppy-o
    (( if(updating){ ))
    Update your opinion
    (( } else { ))
    Save your opinion
    (( } ))

  .position-submit-footer-wrap
    .notifications

      = label_tag :follow_proposal, '', :title => 'We\'ll send periodic email notifications summarizing activity on the proposal, as well as alerts about new pro and con points. You can easily unsubscribe later.' do
        
        (( if (follows) { )) 
        = check_box_tag :follow_proposal, 'true', true
        (( } else { ))
        = check_box_tag :follow_proposal, 'true'
        (( }))

        %span
          Get email updates about new activity

    %a.position-cancel{:'data-target' => 'show-results'}
      cancel and show results
  (( } else { ))
  %a.position-your-action-body.submit{:'data-target' => 'show-results'}
    View results 
  (( } ))


%script{ :type => "text/template", :id => "tpl_reasons_header" }  

  (( if(active) { ))
  %a{ :href => "{{Routes.new_position_proposal_path( long_id )}}", :'data-target' => 'craft-position'}
    //fa-pencil-square-o
    %i.fa.fa-pencil
    {{ call }}
  (( } ))



  

%script{ :type => "text/template", :id => "tpl_reasons_layout"}


  .reasons-lists.l-message-body

    .aggregated-propoints-region.points-list-region
    .position-region
    .aggregated-conpoints-region.points-list-region
  .l-message-speaker.participants

  .reasons-footer-region



////////////// aggregate ////////////
%script{ :type => "text/template", :id => "tpl_aggregate_layout" }  
  
  .histogram-region
  .proposal-socialmedia-region




%script{ :type => "text/template", :id => "tpl_group_container"}
  (( _.each(participants, function(p){ ))
  %span.avatar{ :'data-target' => "user_profile_page",  :'data-id' => "{{p.id}}", :alt => "{{p.get('name')}}'s profile picture", :id => "avatar-{{p.id}}", :class => "participant", :style => "height:{{tile_size}}px; width:{{tile_size}}px;"}
  (( }); ))

%script{ :type => "text/template", :id => "tpl_aggregate_footer_expanded"}
  .placeholder
  // %a.position-your-action-body.join{ :href => "{{Routes.new_position_proposal_path( long_id )}}"}
  //   //fa-pencil-square-o
  //   %i.fa-lg.fa 
  //     &#xf044;  
  //   {{ call }}

%script{ :type => "text/template", :id => "tpl_aggregate_footer_collapsed"}
  %a.reasons-view-results{:'data-target' => 'show-results'}
    //%i.fa.fa-bar-chart-o.fa-lg 
    %i.fa.fa-th-list.fa-lg
    View Results

    
%script{ :type => "text/template", :id => "tpl_aggregate_footer_separated"}
  .placeholder


%script{ :type => "text/template", :id => "tpl_aggregate_histogram"}

  (( _.each(histogram.breakdown, function(bar){ ))

  (( var bucket = bar.bucket; ))
  .histogram-bar{ :style => "height: {{bar.full_size}}px;", :bucket => "{{bucket}}", :id => "bucket-{{bucket}}"}

    (( if(bucket < 4 ){ ))
    = render :partial => "shared/bubble", :locals => {:left => false, :down => true }
    (( } else { ))
    = render :partial => "shared/bubble", :locals => {:left => false, :down => true, :flipped => true }
    (( } ))

    // .bar-position
    //   for {{bar.group_name}}


    (( if (bar.positions.length > 0) { ))
    %ul.bar-people

      (( _.each(bar.positions, function(position) { ))
      (( var user = position.getUser(); ))
      (( if (user){ ))

      (( var has_explanation = position.get('explanation') && position.get('explanation').length > 0, expl_clss = has_explanation ? 'person-has-explanation' : 'person-has-no-explanation'; ))

      %li.bar-person.avatar{:class=>"bucket-{{bucket}} {{expl_clss}}", :'data-target' => "user_profile_page", :'data-id' => "{{user.id}}", :id => "avatar-{{user.id}}", :alt => "{{user.get('name')}}'s profile picture", :style => "height:{{bar.tile_size}}px; width:{{bar.tile_size}}px;"}

      (( } ))
      (( }); ))
    (( } ))

  (( }); ))

  .histogram-base
    .histogram-base-label.histogram-base-label-support
      %span
        {{ supporter_label }}
    .histogram-base-label.histogram-base-label-oppose
      %span
        {{ opposer_label }}


%script{ :type => "text/template", :id => "tpl_proposal_social_media" }
  .proposal-socialmedia-action-call
    Invite your friends to join

  %a{ :href => "https://twitter.com/share", :class => "twitter-share-button", :'data-count' => "none"}
    Tweet
  {{'<' + 'script src="//platform.twitter.com/widgets.js" type="text/javascript"' + '><' + '/script>'}}

  %a.zocial.facebook{ :href => "#", :onclick => "window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href), 'facebook-share-dialog', 'width=626,height=436'); return false;"}
    Share



%script{ :type => "text/template", :id => "tpl_proposal_admin_strip" }
  (( if(!published){ ))
  .proposal-admin-publish
    = form_for :proposal, :url => "{{Routes.proposal_path(long_id)}}", :method => :put, :remote => true, :html => {:class => 'proposal-publish-form'} do |f|
      = f.hidden_field :published, :value => true

      = f.submit 'Done! Publish it.', :class => 'proposal-publish'
  (( } ))

  .proposal-admin_strip
    %i.fa-cog.fa

    .proposal-admin-options-menu-wrap
      %ul.proposal-admin-options-menu
        %li.proposal-admin-publicity.l-dialog-prompt
          %a.proposal-admin_operations-publicity.l-dialog-prompt-label
            //Sharing is 
            %span
              (( if(publicity == 2) { ))
              %i.fa.fa-globe
              Accessible to all
              (( } else if(publicity == 1){ ))
              %i.fa.fa-link
              Accessible by link only
              (( } else { ))
              %i.fa.fa-lock
              Accessible by invite only
              (( } ))

        %li.proposal-admin-status.l-dialog-prompt
          %a.proposal-admin_operations-status.l-dialog-prompt-label
            //Status is 
            %span
              (( if(active){ ))
              %i.fa.fa-microphone
              Conversation is Active
              (( } else { ))
              %i.fa.fa-lg.fa-microphone-slash
              Conversation is Closed
              (( } ))

        %li
          (( var call = published ? 'Delete' : 'nevermind, delete it'; ))

          %a.delete_proposal{ :href => "{{Routes.proposal_path(long_id)}}", :'data-confirm' => "Are you sure you wish to permanently delete this conversation?", :'data-method' => 'delete', :'data-remote' => "true", :rel => "nofollow"}
            %i.fa.fa-small.fa-trash-o
            {{call}}

%script{ :type => "text/template", :id => "tpl_proposal_admin_strip_edit_publicity" }

  = form_for :proposal, :url => "{{Routes.proposal_path(long_id)}}", :method => :put, :remote => true, :html => {:class => 'proposal-admin_operations-settings-form'} do |f|
    .radio_block
      .option
        (( if(publicity == 2) { ))
        = f.radio_button :publicity, '2', :value => '2', :checked => true
        (( } else { ))
        = f.radio_button :publicity, '2', :value => '2'
        (( } ))

        %i.fa.fa-globe
        = f.label :publicity, 'Public', :value => '2'
        .sublabel
          It will be listed on the homepage for all visitors.

      .option
        (( if(publicity == 1) { ))
        = f.radio_button :publicity, '1', :value => '1', :checked => true
        (( } else { ))
        = f.radio_button :publicity, '1', :value => '1'
        (( } ))

        %i.fa.fa-link
        = f.label :publicity, 'Anyone with a link', :value => '1'
        .sublabel
          Only people that have a link to this proposal will be able to access it.

      .option
        (( if(publicity == 0) { ))
        = f.radio_button :publicity, '0', :value => '0', :checked => true
        (( } else { ))
        = f.radio_button :publicity, '0', :value => '0'
        (( } ))

        %i.fa.fa-lock
        = f.label :publicity, 'Private', :value => '0'
        .sublabel
          Restrict access to the following comma-separated list of the emails of invited participants.

        .access_list
          = f.text_area :access_list

    .save_block
      = f.submit 'save'
      %a.cancel{:'data-target' => "dialog-close"}
        cancel

%script{ :type => "text/template", :id => "tpl_proposal_admin_strip_edit_active"}

  = form_for :proposal, :url => "{{ Routes.proposal_path(long_id) }}", :method => :put, :remote => true, :html => {:class => 'proposal-admin_operations-settings-form'} do |f|
    .radio_block
      .option
        (( if(active) { ))
        = f.radio_button :active, true, :value => true, :checked => true
        (( } else { ))
        = f.radio_button :active, true, :value => true
        (( } ))
        %i.fa.fa-microphone        
        = f.label :active, 'Active', :value => true
        .sublabel
          Contributions are open. People with access to this proposal can contribute to it.
      .option
        (( if(active) { ))
        = f.radio_button :active, false, :value => false
        (( } else { ))
        = f.radio_button :active, false, :value => false, :checked => true
        (( } ))

        %i.fa.fa-lg.fa-microphone-slash

        = f.label :active, 'Read-only', :value => false
        .sublabel
          Contributions are closed. People with access to this proposal will only be able to view it. 

    .save_block
      = f.submit 'save'
      %a.cancel{:'data-target' => "dialog-close"}
        cancel