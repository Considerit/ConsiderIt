#######################
# Customizations.coffee
#
# Tailor considerit applications
#
# This file is divided into two parts. 
#   1) Configurable components. These are components used by some subdomains
#      to tailor their functionality.
#   2) Specific subdomain configuration

window.customizations = {}


############################
# CONFIGURABLE COMPONENTS


###########################
# Homepages
# 
# Available Homepages:
#   - SimpleHomepage
#   - LearnShareDecideHomepage
#

#############
# SimpleHomepage
#
# Two column layout, with proposal name and mini histogram. 
# Divided into clusters. 
#
# Customizations: 
#   cluster_options

proposal_support = (proposal) ->
  opinions = fetch('/page/' + proposal.slug).opinions
  if not opinions
    return null
  sum = 0
  for o in opinions
    sum += o.stance
  return sum


sorted_proposals = (cluster) ->
  options = customizations[fetch('/subdomain').name]?.cluster_options?[cluster.name] || {}
  _.clone(cluster.proposals).sort((a,b) ->
    x_a = proposal_support(a) - 10000 + (if options.editor_icons \
                                         and proposal_editor(a) then 1 else 0)
    x_b = proposal_support(b) - 10000 + (if options.editor_icons \
                                         and proposal_editor(b) then 1 else 0)
    return x_b - x_a)

SimpleHomepage = ReactiveComponent
  displayName: 'SimpleHomepage'
  render : ->
    subdomain = fetch('/subdomain')
    proposals = fetch('/proposals')
    line_height = '1.8em'

    DIV
      className: 'simplehomepage'
      style: 
        fontSize: 22
        margin: if !lefty then 'auto'
        width: if !lefty then 705

      STYLE null,
        '''a.proposal:hover {border-bottom: 1px solid grey}'''

      # List all clusters
      for cluster, index in proposals.clusters or []
        if cluster.proposals?.length > 0
          options = customizations[fetch('/subdomain').name]?.cluster_options?[cluster.name] || {}
                    
          first_column =
            width: 350
            marginLeft: if lefty then 200
            display: 'inline-block'
            verticalAlign: 'top'

          secnd_column =
            width: 300
            display: 'inline-block'
            verticalAlign: 'top'
            marginLeft: 50

          first_header =
            fontSize: 36
            marginBottom: 40
            fontWeight: 600
          _.extend(first_header, first_column)

          secnd_header =
            fontSize: 36
            marginBottom: 45
            fontWeight: 600
            position: 'relative'
            whiteSpace: 'nowrap'
          _.extend(secnd_header, secnd_column)

          #
          # Cluster of proposals
          DIV
            style: margin: '45px 0'

            # Header of cluster
            H1
              style: first_header
              cluster.name || 'Proposals'
            H1
              style: secnd_header
              SPAN
                style:
                  position: 'absolute'
                  bottom: -43
                  fontSize: 21
                  color: '#444'
                  fontWeight: 300
                sliderPole('individual', 'oppose')
              SPAN
                style:
                  position: 'absolute'
                  bottom: -43
                  fontSize: 21
                  color: '#444'
                  right: 0
                  fontWeight: 300
                sliderPole('individual', 'support')
              SPAN 
                style: 
                  position: 'relative'
                  marginLeft: -(widthWhenRendered(options.homie_histo_title || 'Opinions', {fontSize: 36, fontWeight: 600}) - secnd_column.width)/2
                options.homie_histo_title || 'Opinions'

            for proposal in sorted_proposals(cluster)
              icons = options.editor_icons

              # Proposal
              DIV
                key: proposal.key
                style:
                  minHeight: 70

                DIV style: first_column,

                  if icons
                    editor = proposal_editor(proposal)

                    # Person's icon
                    A
                      href: proposal_url(proposal)
                      onClick: clickInternalLink
                      Avatar
                        key: editor
                        user: editor
                        style:
                          height: 50
                          width: 50
                          borderRadius: 0
                          backgroundColor: '#ddd'

                  # Name of Proposal
                  DIV
                    style:
                      display: 'inline-block'
                      fontWeight: 400
                      marginLeft: if icons then 18
                      paddingBottom: 20
                      width: first_column.width - 50 + (if icons then -18 else 0)
                      marginTop: if icons then 9
                    A
                      className: 'proposal'
                      style: if not icons then {borderBottom: '1px solid grey'}
                      onClick: clickInternalLink
                      href: proposal_url(proposal)
                      proposal.name

                # Histogram for Proposal
                A
                  href: proposal_url(proposal)
                  onClick: clickInternalLink
                  DIV
                    style: secnd_column
                    MiniHisto(proposal: proposal, width: 300, height: 50)


####
# LearnDecideShareHomepage
#
# A homepage where proposals are shown in a four column
# table with a prominent sticky header. 
#
# Proposals are divided into clusters. 
# 
# Customizations:
#
#  homepage_heading_columns
#    The labels of the four columns
#  cluster_options

LearnDecideShareHomepage = ReactiveComponent
  displayName: 'Homepage'

  componentDidMount : -> @initOrUpdateHeader()

  componentDidUpdate : -> @initOrUpdateHeader()

  componentWillUnmount : -> 
    $el = $(@getDOMNode())
    $el.find('.sticky_header.stickable').StickyElement('destroy')

  initOrUpdateHeader : -> 
    $el = $(@getDOMNode())

    $header = $el.find('.sticky_header.stickable')
    if $header.length > 0
      $header.StickyElement
        placeholder: $el.find('.sticky_header.placeholder')[0]
        container: $el
        stick_on_zoomed_screens: false

  render : ->
    subdomain = fetch('/subdomain')
    proposals = fetch('/proposals')

    # The "Welcome to the community!" people
    contributors = @page.contributors.filter((u)-> !!fetch(u).avatar_file_name)
    contributors_without_avatar_count = @page.contributors.filter((u)-> !fetch(u).avatar_file_name).length

    # Columns of the sticky header for the proposal list.
    columns = customizations[subdomain.name]?.homepage_heading_columns or [ 
                  {heading: 'Learn', details: 'about the issues'}, \
                  {heading: 'Decide', details: 'what you think'}, \
                  {heading: 'Share', details: 'your opinion'}, \
                  {heading: 'Join', details: 'the contributors'}]

    sticky_header_height = 79

    DIV className: 'homepage',

      # Draw the sticky subheader
      DIV className: "sticky_header placeholder", style: {width: '100%', height: sticky_header_height}
      DIV 
        className: "sticky_header stickable"
        style: 
          backgroundColor: subdomain.branding.primary_color
          color: 'white'
          height: sticky_header_height
          width: '100%'
          zIndex: 9999
          minWidth: PAGE_WIDTH #minwidth is for when dropping into sticky, position fixed mode

        TABLE style: {margin: 'auto', paddingLeft: 242},
          TBODY null,
            TR null,
              for col in columns
                TD style: {display: 'inline-block', width: 250},
                  DIV 
                    style: 
                      fontWeight: 700
                      fontSize: 42
                      textAlign: 'center'
                    col.heading
                  DIV 
                    style: 
                      fontWeight: 300
                      fontSize: 18
                      textAlign: 'center'
                      position: 'relative'
                      top: -8
                    col.details

      DIV style: {marginTop: 30},
        if contributors.length > 0
          DIV 
            style: 
              width: PAGE_WIDTH
              position: 'relative'
              margin: 'auto'
            DIV 
              style:
                left: 1005
                position: 'absolute'
                width: 165
                textAlign: 'left'
                zIndex: 1

              for user in _(contributors).first(90)
                Avatar key: user, className: 'welcome_avatar', style: {height: 32, width: 32, margin: 1}
              if contributors_without_avatar_count > 0
                others = if contributors_without_avatar_count != 1 then 'others' else 'other'
                DIV style: {fontSize: 14, color: "#666"}, "...and #{contributors_without_avatar_count} #{others}"

        # Draw the proposal summaries
        for cluster, index in proposals.clusters or []
          options = customizations[fetch('/subdomain').name]?.cluster_options?[cluster.name] || {}
          DIV null,
            if index == 1 and subdomain.name == 'livingvotersguide'
              customizations.livingvotersguide.ZipcodeBox()

            if cluster.proposals?.length > 0 
              TABLE
                style:
                  borderLeft: '0px solid rgb(191, 192, 194)'
                  margin: '20px auto'
                  position: 'relative'

                TBODY null,
                  TR null,
                    # Draw the cluster name off to the side
                    TH 
                      style: 
                        textAlign: 'right'
                        width: 115
                        padding: '8px 8px 8px 8px'
                        display: 'inline-block'
                        fontSize: 18
                        position: 'absolute'
                        left: -125
                        fontWeight: if browser.high_density_display then 300 else 400
                      cluster.name                

                  # Draw each proposal summary
                  for proposal in cluster.proposals
                    ProposalSummary
                      key: proposal.key
                      cluster: cluster.name
            
            # Cluster description
            if options.description 
              DIV
                style:
                  color: 'rgb(108,107,98)'
                  fontSize: 16
                  paddingLeft: 164
                  paddingTop: 12
                  margin: 'auto'
                  width: PAGE_WIDTH
                options.description

      if permit('create proposal') > 0
        # lazily styled & positioned...
        DIV style: {width: 871, margin: 'auto'}, 
          A 
            style: {color: '#888', textDecoration: 'underline', fontSize: 18, marginLeft: 30}
            href: '/proposal/new'
            onClick: (e) => 
              clickInternalLink(e)
              $(document).scrollTop(0)
            'Create new proposal'

# Used by the LearnDecideShare homepage
ProposalSummary = ReactiveComponent
  displayName: 'ProposalSummary'

  render : ->
    subdomain = fetch('/subdomain')

    proposal = @data()
    your_opinion = fetch(proposal.your_opinion)
    
    hover_class = if @local.hovering_on == proposal.id then 'hovering' else ''

    link_hover_color = focus_blue
    cell_border = "1px solid #{if @local.hovering_on then link_hover_color else 'rgb(191, 192, 194)'}"
    TR 
      className: "proposal_summary " + hover_class
      style:
        height: ''
        padding: '0 30px'
        display: 'block'
        borderLeft: cell_border
        minHeight: 60
      onMouseEnter: => @local.hovering_on = true; save(@local)
      onMouseLeave: => @local.hovering_on = false; save(@local)

      TD 
        className: 'summary_name'
        style: 
          width: 320
          display: 'inline-block'
          fontSize: 18
          fontWeight: 500

        A 
          onClick: clickInternalLink
          href: proposal_url(proposal)
          style: 
            color: "#{if @local.hovering_on then link_hover_color else ''}" 
            borderBottom: '1px solid #b1afa7'

          if subdomain.name == 'livingvotersguide' && proposal.category 
            "#{proposal.category[0]}-#{proposal.designator}: "
          proposal.name

      TD
        style: 
          borderLeft: cell_border
          borderRight: cell_border
          cursor: 'pointer'
          width: 170
          textAlign: 'center'
          display: 'inline-block'
          height: '100%'
          minHeight: 66

        onClick: (=> window.app_router.navigate("/#{proposal.slug}", {trigger: true}))
        if !proposal.your_opinion || !your_opinion.published \
           || isNeutralOpinion(your_opinion.stance)
          style = {fontWeight: 400, color: 'rgb(158,158,158)', fontSize: 21}
          if @local.hovering_on
            style.color = 'black'
            style.fontWeight = 600
          SPAN style: style, '?'
        else if your_opinion.stance < 0 && !isNeutralOpinion(your_opinion.stance)
          SPAN style: {position: 'relative', left: 14},
            IMG 
              className: 'summary_opinion_marker'
              src: "<%= asset_path 'no_x.svg' %>"
              style: {width: 24, position: 'absolute', left: -28}
            SPAN style: {color: 'rgb(239,95,98)', fontSize: 18, fontWeight: 600}, 'No'
        else
          SPAN style: {position: 'relative', left: 14},
            IMG 
              className: 'summary_opinion_marker'
              src: "<%= asset_path 'yes_check.svg' %>"
              style: {width: 24, position: 'absolute', left: -28}

            SPAN style: {color: 'rgb(166,204,70)', fontSize: 18, fontWeight: 600}, 'Yes'

      TD
        className: 'summary_share'
        style: 
          cursor: 'pointer'
          width: 320
          display: 'inline-block'
          paddingLeft: 15
          marginTop: -4

        onClick: (=> window.app_router.navigate(proposal_url(proposal), {trigger: true}))
        if proposal.top_point
          DIV 
            className: 'top_point community_point pro'
            style : { width: 270, position: 'relative' }

            DIV className:'point_content',
              IMG 
                className: 'community_point_mouth'
                src: "<%= asset_path 'community_point_mouth.png' %>"

              DIV className:'point_nutshell', style: {fontSize: 15},
                "#{proposal.top_point.nutshell[0..30]}..."

###########################
# Proposal headers
# 
# Available proposal headers:
#   - SimpleProposalHeading
#   - StickyProposalHeader
#

##
# SimpleProposalHeading
#
# A non-sticky header that displays a prev/next proposal button & cluster name
#
# Customizations:
#  cluster_options
#  hide_home_button_in_proposal_header

window.SimpleProposalHeading = ReactiveComponent
  displayName: 'ProposalHeader'
  render : ->
    subdomain = fetch('/subdomain')
    proposals = fetch('/proposals')
    heading_fontsize = 45
    options = customizations[fetch('/subdomain').name]?.cluster_options?[@proposal.cluster] || {}
    show_home_button = !customizations[subdomain.name]?.hide_home_button_in_proposal_header

    mod = (n, m) -> ((n % m) + m) % m

    # Determine the next proposal
    next_proposal = prev_proposal = null
    if proposals.clusters  # In case /proposals isn't loaded
      curr_cluster = _.findWhere proposals.clusters, {name: @proposal.cluster}
      if curr_cluster?.proposals.length > 1
        proposals = sorted_proposals(curr_cluster)
        # Now find the current proposal in the cluster, and return the next one
        for proposal, index in proposals
          if @proposal == proposal
            break
        next_index = mod(index + 1, proposals.length)
        prev_index = mod(index - 1, proposals.length)
        next_proposal = proposals[next_index]
        prev_proposal = proposals[prev_index]

    DIV
      style:
        paddingBottom: 15
        margin: if lefty then "30px 0 0 300px" else "30px auto 0 auto"
        width: BODY_WIDTH + 20
        position: 'relative'
        left: if !lefty then 10

      # Previous button
      if prev_proposal
        A
          style:
            position: 'absolute'
            right: 74
          onClick: do (url = proposal_url(prev_proposal)) =>
            => window.app_router.navigate(url, {trigger: true})
          '< Prev'

      # Home button
      if show_home_button
        A
          onClick: (=> window.app_router.navigate("/", {trigger: true}))
          style: 
            position: 'absolute'
            right: 41

          I 
            className: 'fa fa-home'
            style: 
              fontSize: 20

      # Next button
      if next_proposal
        A
          style:
            position: 'absolute'
            right: if show_home_button then -23 else 0
          onClick: do (url = proposal_url(next_proposal)) =>
            => window.app_router.navigate(url, {trigger: true})
          'Next >'

      # Photo
      if options.editor_icons
        editor = proposal_editor(@proposal)
        if editor
          Avatar
            key: editor
            user: editor
            img_size: 'original'
            style:
              position: 'absolute'
              #height: 225
              width: 225
              marginLeft: -225 - 35
              borderRadius: 0
              backgroundColor: 'transparent'

      # Cluster name
      DIV
        style:
          fontStyle: 'italic'
          visibility: if !@proposal.cluster then 'hidden'

        @proposal.cluster or '-'

      # Proposal name
      DIV
        style:
          lineHeight: 1.2
          fontWeight: 700
          fontSize: heading_fontsize
        @proposal.name


####
# A header that sticks to the top of the page. 
# Shows the proposal title with a drop down menu
# for navigating to any other proposal. 
# Has a link to the homepage. 
#

StickyProposalHeader = ReactiveComponent
  displayName: 'StickyProposalHeader'
  render : ->
    subdomain = fetch('/subdomain')
    proposals = fetch('/proposals')

    # If navigation bar is enabled, then we'll use a really short proposal name in the heading.
    # Otherwise we'll display the full question. This split doesn't come from
    # deep thought. Right now we'll just show the nav bar if the proposal belongs to a group
    use_navigation_bar = @proposal.cluster && proposals

    if not use_navigation_bar
      heading_style =
        textAlign: 'center'
        minWidth: PAGE_WIDTH # for width consistency when dropping into fixed sticky header
        backgroundColor: subdomain.branding.primary_color
        fontSize: 26
        padding: '4px 90px'

      return DIV null,
               DIV className: 'proposal_heading stickable',   style: heading_style,
                 SPAN null, @proposal.name
               DIV className: 'proposal_heading placeholder', style: heading_style,
                 SPAN null, @proposal.name
    
    # Now we know that we are drawing the navigation bar

    # Determine the next proposal
    if proposals.clusters  # In case /proposals isn't loaded
      curr_cluster = _.findWhere proposals.clusters, {name: @proposal.cluster}

    next_proposal =
      if curr_cluster?.proposals.length > 1
        # Now find the current proposal in the cluster, and return the next one
        for proposal, index in curr_cluster.proposals
          if @proposal == proposal
            break
        next_index = (index + 1) % curr_cluster.proposals.length
        curr_cluster.proposals[next_index]

    heading_height = 50
    DIV null, 
      DIV className: 'proposal_heading placeholder', style: {height: heading_height} 
      DIV
        id: 'proposal_heading'
        className: 'proposal_heading stickable'
        style:
          height: heading_height
          minWidth: PAGE_WIDTH # for width consistency when dropping into fixed sticky header
          backgroundColor: subdomain.branding.primary_color
          textAlign: 'center'

        A
          onClick: (=> window.app_router.navigate("/", {trigger: true}))
          style: {position: 'absolute', display: 'inline-block', top: 10, left: 12},
          I className: 'fa fa-home', style: {fontSize: 28, color: 'white'}

        DIV
          style: 
            display: 'inline-block'
            position: 'absolute'
            left: 58
            fontSize: 18
            paddingTop: 12

          @proposal.cluster

        DIV
          # Set the width so we can align it perfectly with the proposal description text:
          style: 
            width: DESCRIPTION_WIDTH
            textAlign: 'left'
            margin: 'auto'
            marginLeft: if lefty then 300
            #marginRight: if lefty then 0

          DIV style: {width: CONTENT_WIDTH}, # ...but let the stuff inside be big
            DIV
              style:
                fontSize: 22
                fontWeight: 700
                position: 'relative'
                top: 4


              DIV 
                style: 
                  backgroundColor: 'rgba(0,0,0,.2)'
                  padding: '3px 15px'
                  borderRadius: 6
                  marginTop: 3
                  display: 'inline-block'
                  cursor: 'pointer'
                onMouseEnter: (=> @local.dropped_down = true; save(@local))
                onMouseLeave: (=> @local.dropped_down = false; save(@local))

                SPAN null,
                  "#{if @proposal.designator && @proposal.category then "#{@proposal.category[0]}-#{@proposal.designator} " else ''}#{@proposal.name}" 
                  I 
                    className: 'fa fa-caret-down'
                    style: 
                      paddingLeft: 8
                      fontSize: 30
                      position: 'relative'
                      top: 2

                if @local.dropped_down
                  DIV 
                    style: 
                      width: 500
                      position: 'absolute'
                      top: 38
                      paddingTop: 5

                    DIV style: {backgroundColor: subdomain.branding.primary_color, borderRadius: '4px'},
                      DIV style: {backgroundColor: 'rgba(0,0,0,.2)', padding: '14px 0', borderRadius: '4px'},

                        if curr_cluster?.proposals.length > 1
                          DIV null,
                            TABLE className: 'current_cluster', style: {width: '100%'},
                              TBODY null,
                                for other_proposal in curr_cluster.proposals
                                  TR href: proposal_url(other_proposal), onClick: clickInternalLink, key: "tr/#{other_proposal.slug}",
                                    TD style: {textAlign: 'left', paddingLeft: 20},
                                      A 
                                        href: proposal_url(other_proposal)
                                        onClick: clickInternalLink
                                        style: 
                                          color: 'white'
                                          fontWeight: if other_proposal.key == @proposal.key then 700 else 400
                                          fontSize: 18                                        
                                        other_proposal.name

                                    TD style: {position: 'relative'},
                                      if !other_proposal.your_opinion || !fetch(other_proposal.your_opinion).published
                                        SPAN style: {fontWeight: 400, color: 'rgb(205,205,205)', fontSize: 21}, '?'
                                      else
                                        # make a small slider summary
                                        opinion = fetch(other_proposal.your_opinion)
                                        face_size = 20 # height/width of the summary slider bar
                                        eye_style = { width: 2, height: 2, borderRadius: '50%', backgroundColor: subdomain.branding.primary_color, position: 'absolute', top: 6 }
                                        mouth_style = {fontSize: 12, color: subdomain.branding.primary_color, left: face_size * .45, top: face_size * .28, position: 'absolute', transform: 'rotate(90deg)'}
                                        css.crossbrowserify mouth_style
                                        if isNeutralOpinion(fetch(other_proposal.your_opinion).stance)
                                          # confused!
                                          mouth = '|'
                                        else if opinion.stance < 0
                                          # frown!
                                          mouth = '('
                                        else
                                          # pleased!
                                          mouth = ')'

                                        DIV 
                                          style: 
                                            borderBottom: "1px solid white"
                                            width: 100
                                            position: 'relative'
                                            top: 15

                                          DIV
                                            style: 
                                              borderRadius: '50%'
                                              backgroundColor: 'white'
                                              width: face_size
                                              height: face_size
                                              position: 'absolute'
                                              top: -face_size / 2
                                              marginLeft: -face_size / 2 
                                              left: "#{100 * (opinion.stance + 1.0) / 2.0}%"
                                            DIV style: _.extend {}, eye_style, {left: 6} # left eye
                                            DIV style: _.extend {}, eye_style, {left: face_size - 8} # right eye
                                            DIV style: mouth_style, mouth


                                    TD style: {paddingRight: 20}

                            DIV className: 'separator', style: {borderBottom: '1px dotted #dedede', width: '85%', margin: '28px auto 12px auto'}

                        DIV className: 'other_clusters',
                          for cluster in proposals.clusters
                            if @proposal.cluster != cluster.name && cluster.proposals.length > 0
                              do (cluster) =>
                                DIV 
                                  className: 'another_cluster'
                                  onMouseEnter: => @local.show_cluster = cluster.name; save(@local)
                                  onMouseLeave: => @mouseLeaveOtherCluster(cluster.name)
                                  style: {padding: '0 50px', width: '100%', position: 'relative'}

                                  SPAN style: {float: 'left', fontSize: 18, fontWeight: 400},
                                    cluster.name
                                  I className: 'fa fa-caret-right', style: {float: 'right'}
                                  DIV style: {clear: 'both'}

                                  if @local.show_cluster == cluster.name
                                    DIV style: {width: 300, zIndex: 99999, backgroundColor: subdomain.branding.primary_color, borderRadius: '4px', position: 'absolute', left: 458, top: -12},                                  
                                      UL className: 'other_proposal_list', style: {backgroundColor: 'rgba(0,0,0,.2)', borderRadius: '4px', padding: '8px 0' },
                                        for other_proposal in cluster.proposals
                                          LI style: {listStyle: 'none'}, key: "li/#{other_proposal.slug}",
                                            A 
                                              href: proposal_url(other_proposal)
                                              onClick: clickInternalLink
                                              style:
                                                display: 'block'
                                                textAlign: 'left'
                                                padding: '2px 10px'
                                                color: 'white'
                                                fontSize: 18
                                                fontWeight: 400
                                              other_proposal.name


              # if next_proposal
              #   A 
              #     style: 
              #       fontSize: 15
              #       marginLeft: 50
              #       display: 'inline-block'
              #       fontWeight: 400
              #       color: 'white'
              #       textDecoration: 'underline'

              #     onClick: do (url = proposal_url(next_proposal)) =>
              #       => window.app_router.navigate(url, {trigger: true})
              #     'Next >' 

  componentDidMount : -> @initOrUpdateHeader()
  componentDidUpdate : -> @initOrUpdateHeader()

  initOrUpdateHeader : -> 
    $el = $(@getDOMNode())

    $header = $el.find('.proposal_heading.stickable')

    if $header.length > 0 && !@is_waiting()
      $header.StickyElement
        placeholder: $el.find('.proposal_heading.placeholder')[0]
        container: $el.parents('.proposal')
        stick_on_zoomed_screens: false

  componentWillUnmount : -> 
    $el = $(@getDOMNode())
    $el.find('.proposal_heading.stickable').StickyElement('destroy')
  mouseLeaveOtherCluster : (cluster) -> 
    if @local.show_cluster == cluster
      @local.show_cluster = null
      save(@local)

styles += """
.current_cluster tr:hover, .other_proposal_list li:hover {
  background-color: rgba(0, 0, 0, 0.1);
  cursor: pointer; }

.proposal_heading {
  width: 100%;
  color: white;
  z-index: 999;
  position: relative; }
"""


######################
# Default customizations
customizations.default = 

  show_crafting_page_first: false

  slider_pole_labels :
    individual: 
      support: 'Support'
      oppose: 'Oppose'
    group: 
      support: 'Supporters'
      oppose: 'Opposers'

  Homepage : SimpleHomepage
  ProposalHeader : SimpleProposalHeading

  HomepageHeader : ReactiveComponent
    displayName: 'HomepageHeader'

    render: ->
      subdomain = fetch '/subdomain'   

      masthead_style = 
        textAlign: 'center'
        backgroundColor: subdomain.branding.primary_color
        height: 45

      if subdomain.branding.masthead
        _.extend masthead_style, 
          height: 300
          backgroundPosition: 'center'
          backgroundSize: 'cover'
          backgroundImage: "url(#{subdomain.branding.masthead})"   
             
      DIV style: masthead_style,
        ProfileMenu()

        if subdomain.branding.masthead_header_text
          DIV style: {color: 'white', margin: 'auto', fontSize: 60, fontWeight: 700, position: 'relative', top: 50}, 
            if subdomain.external_project_url
              A href: "#{subdomain.external_project_url}", target: '_blank',
                subdomain.branding.masthead_header_text
            else
              subdomain.branding.masthead_header_text

  Footer : ReactiveComponent
    displayName: 'Footer'
    render: ->
      subdomain = fetch '/subdomain'
      DIV
        style: 
          position: 'relative'
          padding: '2.5em 0 .5em 0'
          textAlign: 'center'
          margin: 'auto'
          marginLeft: if lefty then 20 + BODY_WIDTH / 2
          width: BODY_WIDTH

        A href: "#{subdomain.external_project_url}", target: '_blank', style: {display: 'inline-block', margin: 'auto'},
          if subdomain.branding.logo
            IMG src: "#{subdomain.branding.logo}", style: {width: 300}

        DIV style: {marginTop: 30, fontSize: '70%'},
          TechnologyByConsiderit()
          DIV style: {color: 'rgb(131,131,131)', marginTop: 5},
            'Bug to report? Want to use this technology in your organization? '
            A style: {textDecoration: 'none', fontWeight: 700}, href: "mailto:admin@consider.it", 'Email us'




TechnologyByConsiderit = ReactiveComponent
  displayName: 'TechnologyByConsiderit'
  render : -> 
    DIV style: {textAlign: 'left', color: 'rgb(131,131,131)', display: 'inline-block', fontSize: 20},
      "Technology by "
      A href: 'http://consider.it', style: {textDecoration: 'underline', color: '#B03B42', fontWeight: 600}, target: '_blank', 'Considerit'



##########################
# SUBDOMAIN CONFIGURATION
##########################

##############
# ECAST

ecast_highlight_color =  "#73B3B9"  #"#CB7833"
customizations.ecastonline = customizations['ecast-demo'] = 
  show_crafting_page_first: true

  slider_pole_labels :
    individual: 
      support: 'Agree'
      oppose: 'Disagree'
    group: 
      support: 'Agree'
      oppose: 'Disagree'

  ProposalHeader: StickyProposalHeader

  auth: 

    additional_auth_footer: -> 

      auth = fetch('root').auth
      if auth.ask_questions && auth.form != 'edit profile'
        return DIV 
          style:
            fontSize: 13
            color: auth_text_gray
            padding: '16px 0' 
          """
          The demographic data collected from participants in this project will be used for research purposes, for 
          example, to identify the demographic and other characteristics of the people who participated in the 
          deliberation.  This information can be used in analyzing the results of this online forum.  
          No email addresses, demographic data, or personally-identifying information will be displayed to 
          other visitors to this site.  Any comments you submit will be identified only by the display name 
          you enter below.  By completing this registration, you acknowledge that your participation in this 
          project is entirely voluntary and you agree that the data provided may be used for research. If you 
          have any questions or concerns at any time, please 
          """
          A 
            href: 'mailto:info@ecastonline.org'
            target: "_blank"
            style: 
              textDecoration: 'underline'
             "Contact Us"
          "."
      else 
        SPAN null, ''

    user_questions : [
      { 
        tag: 'zip.editable'
        question: 'My zip code is'
        input: 'text'
        required: true
        input_style: 
          width: 85
        validation: (zip) ->
          return /(^\d{5}$)|(^\d{5}-\d{4}$)/.test(zip)
      }, {
        tag: 'gender.editable'
        question: 'My gender is'
        input: 'dropdown'
        options:['Male', 'Female']
        required: true
      }, {
        tag: 'age.editable'
        question: 'My age is'
        input: 'text'
        required: true
        input_style: 
          width: 50
        validation: (age) -> 
          return /^[1-9]?[0-9]{1}$|^100$/.test(age)
      }, {
        tag: 'ethnicity.editable'
        question: 'My ethnicity is'
        input: 'dropdown'
        options:['African American', 'Asian', 'Latino/Hispanic', 'White', 'Other']
        required: true
      }, {
        tag: 'education.editable'
        question: 'My formal education is'
        input: 'dropdown'
        options:['Did not graduate from high school', 'Graduated from high school or equivalent', 'Attended, but did not graduate from college', 'College degree', 'Graduate professional degree']
        required: true
      }]


  cluster_options :
    Recommendations:
      homie_histo_title: "Citizens' opinions"
    Mitigation:
      homie_histo_title: "Citizens' opinions"
    Detection:
      homie_histo_title: "Citizens' opinions"

  NonHomepageHeader : ReactiveComponent
    displayName: 'NonHomepageHeader'

    render: ->
      DIV 
        style: 
          backgroundColor: 'black'
          width: '100%'
          position: 'relative'
          borderBottom: "2px solid #{ecast_highlight_color}"
          padding: "10px 0"
          backgroundImage: "url(<%= asset_path 'ecast/bg.png' %>)"
          height: 98

        A 
          href: "http://ecastonline.org/"
          target: '_blank'
          IMG 
            style: 
              height: 75
              position: 'absolute'
              left: 50
              top: 10

            src: "<%= asset_path 'ecast/ecast.png' %>"

        A 
          style: 
            fontSize: 30
            fontWeight: 600
            color: 'white'
            textShadow: '0 2px 4px rgba(0,0,0,.5)'       
            position: 'relative'
            top: 20
            left: 250 
          href: '/'
          onClick: clickInternalLink
          "Informing NASA's Asteroid Initiative: A Citizen Forum"



        ProfileMenu()

  HomepageHeader : ReactiveComponent
    displayName: 'HomepageHeader'

    render : ->
      window.lefty = true

      paragraph_style = 
        marginBottom: 20
        textShadow: '0 1px 1px rgba(255,255,255,.5)'
        fontWeight: 600

      DIV 
        style: 
          backgroundColor: 'black'
          height: 685
          overflow: 'hidden'
          width: '100%'
          position: 'relative'
          borderBottom: "5px solid #{ecast_highlight_color}"

        IMG 
          style: 
            position: 'absolute'
          src: "<%= asset_path 'ecast/bg.png' %>"

        # Title of site
        DIV 
          style: 
            position: 'absolute'
            left: 50
            top: 38

          DIV 
            style: 
              fontSize: 42
              fontWeight: 600
              color: 'white'
              textShadow: '0 2px 4px rgba(0,0,0,.5)'

            A 
              href: '/'
              onClick: clickInternalLink
              "Informing NASA's Asteroid Initiative"

          DIV
            style: 
              fontSize: 24
              fontWeight: 600         
              color: 'white'
              textAlign: 'center'
              marginTop: -5
 
            A
              href: '/'
              onClick: clickInternalLink
              "A Citizen Forum"

        # Credits
        DIV 
          style:
            position: 'absolute'
            top: 61
            left: 790

          DIV 
            style: 
              fontSize: 18
              color: 'white'
            'hosted by'

          A 
            href: "http://ecastonline.org/"
            target: '_blank'
            IMG 
              style: 
                display: 'block'
                marginTop: 4
                width: 215
              src: "<%= asset_path 'ecast/ecast.png' %>"

          # DIV 
          #   style: 
          #     fontSize: 18
          #     color: 'white'
          #     marginTop: 12              
          #   'supported by'

          # A 
          #   href: "http://www.nasa.gov/"
          #   target: '_blank'

          #   IMG 
          #     style: 
          #       display: 'block'
          #       marginTop: 4
          #       width: 160

          #     src: "<%= asset_path 'ecast/nasa.png' %>"

        # Video callout
        DIV
          style: 
            position: 'absolute'
            left: 434
            top: 609
            color: ecast_highlight_color
            fontSize: 17
            fontWeight: 600
            width: 325

          I 
            className: 'fa fa-film'
            style: 
              position: 'absolute'
              left: -27
              top: 3
          'Learn more first! Watch this video from the public forums that ECAST hosted.'

          SPAN
            style: 
              position: 'absolute'
              top: 24
              right: -15

            I
              className: 'fa fa-angle-right'
              style: 
                paddingLeft: 10
            I
              className: 'fa fa-angle-right'
              style: 
                paddingLeft: 5
            I
              className: 'fa fa-angle-right'
              style: 
                paddingLeft: 5


        # Video
        IFRAME
          position: 'absolute'
          type: "text/html" 
          width: 370
          height: 220
          src: "//www.youtube.com/embed/6yImAjIws9A?autoplay=0"
          frameborder: 0
          style:
            top: 460
            left: 790
            zIndex: 99
            position: 'absolute'
            border: "5px solid #{ecast_highlight_color}"
            borderBottom: 'none'


        # Text in bubble
        DIV 
          style: 
            fontSize: 17
            position: 'absolute'
            top: 156
            left: 97
            width: 600

          P style: paragraph_style, 
            "In its history, the Earth has been repeatedly struck by asteroids, large chunks of rock from space that can cause considerable damage in a collision. Can we—or should we—try to protect Earth from potentially hazardous impacts?"

          P style: paragraph_style, 
            "Sounds like stuff just for rocket scientists. But how would you like to be part of this discussion?"

          P style: paragraph_style, 
            "Now you can! NASA is collaborating with ECAST—Expert and Citizen Assessment of Science and Technology—to give citizens a say in decisions about the future of space exploration."

          P style: paragraph_style, 
            "Join the dialogue below about detecting asteroids and mitigating their potential impact. The five recommendations below emerged from ECAST public forums held in Phoenix and Boston last November." 

          P style: paragraph_style, 
            "Please take a few moments to review the background materials and the recommendations, and tell us what you think! Your input is important as we analyze the outcomes of the forums and make our final report to NASA." 

        ProfileMenu()

styles += """
[subdomain="ecastonline"] .simplehomepage a.proposal, [subdomain="ecast-demo"] .simplehomepage a.proposal{
  border-color: #{ecast_highlight_color} !important;
  color: #{ecast_highlight_color} !important;
}
"""


####################
# Bitcoin

# Redirect for old bitcoin
if window.location.hostname == 'bitcoin-election.consider.it'
  window.location.replace(window.location.href.replace('https://bitcoin-election', 'https://bitcoin'))

bitcoin_foundation_members = JSON.parse("{\"Xiaolai\":true,\"John Adair\":true,\"Kevin Adolph\":true,\"Vincenzo Agui\":true,\"Peter Michael Akaeze-Lawson\":true,\"Jack (Curtis) Alderson\":true,\"Kevin Aleman\":true,\"Xavier Alexandre\":true,\"Tariq Ali\":true,\"Andy Alterini\":true,\"Marwan Alzarouni\":true,\"Franco Amati\":true,\"Frank Amato\":true,\"kanat amrenov\":true,\"Rodolfo Andragnes\":true,\"Jogundas Armaitis\":true,\"Yoni Assia\":true,\"Adam Atlas\":true,\"Martin Auer\":true,\"Karsten B.\":true,\"Brian Babiak MD\":true,\"Guillaume Babin Tremblay\":true,\"Venugopal Badaravada\":true,\"Kevin Baker\":true,\"Steven Baker\":true,\"Oleksii Balinskyi\":true,\"Maciej Jakub Bańkowski\":true,\"Davide Barbieri\":true,\"Joseph Barnes\":true,\"Niels Bartels\":true,\"Chris Beams\":true,\"John Beauregard\":true,\"Douglas Bebber\":true,\"Alexander Becker\":true,\"Matthew Beller, CFA\":true,\"David Bensoussan\":true,\"Nikos Bentenitis\":true,\"Garland William Binns III\":true,\"Richard Birgersson\":true,\"Neal Blackburn\":true,\"Armin Blasbichler\":true,\"Michael Blatter\":true,\"Christian Bodt\":true,\"Dmitriy Bogomolov\":true,\"John Bolton\":true,\"Michael Bombace\":true,\"Kevin Bombino\":true,\"Early Boykins III\":true,\"Ross Branstetter\":true,\"Alexander Brant-Zawadzki\":true,\"Ivan Brightly\":true,\"Scott Brooker\":true,\"Laurent Bruchez, CFA\":true,\"Rich Brumpton\":true,\"Jeff Buck\":true,\"Massimo Bugelli\":true,\"Gal Buki\":true,\"Matthew Burgess\":true,\"Alexander Burkardt\":true,\"Matthew Burris\":true,\"Jim Burton\":true,\"Andriy Bushtruk\":true,\"James Byrum\":true,\"Mike Caldwell\":true,\"Brenton Camac\":true,\"Jonathan Care\":true,\"Saivann Carignan\":true,\"Mark Carlson\":true,\"Stan Carney\":true,\"Germano Caronni\":true,\"Michael Carrier\":true,\"Ryan Casey\":true,\"Gustavo Chamati\":true,\"Angus Champion de Crespigny\":true,\"Binglin Chang\":true,\"Stephanie Chang\":true,\"Karl Chappé\":true,\"Lisa Cheng\":true,\"Ho Lum Cheung\":true,\"Teck Chia\":true,\"Theo Chino\":true,\"Pavel Chorbadzhiyski\":true,\"Lim Boon Chuan\":true,\"zou chun\":true,\"Irina Cioaca\":true,\"Mashuri Clark\":true,\"Jeff Coleman\":true,\"Matthew Corallo\":true,\"Shaun Cowley\":true,\"Nick Craig\":true,\"Darío Cravero\":true,\"Jan Creemers\":true,\"Timothy Crimmins\":true,\"Daryl Cusack\":true,\"Chris D\'Costa\":true,\"Joel Dalais\":true,\"Bilal Ijaz Dar\":true,\"Brandon Dart\":true,\"Ben Davenport\":true,\"Gareth Davies\":true,\"Gerald Davis\":true,\"Mieke de Haas\":true,\"Alwin de Romijn\":true,\"Barnabas Debreczeni\":true,\"Christian Decker\":true,\"Michael Deeg\":true,\"George Degennaro\":true,\"Daniel Deitrick\":true,\"Jose Delavalle Tcherassi\":true,\"Enrique Delgado\":true,\"Ryan Deming\":true,\"Marnix den Otter\":true,\"Andrew DeSantis\":true,\"Raam Dev\":true,\"Marco Di Mare\":true,\"Paolo Di Paolantonio\":true,\"Nilam Doctor\":true,\"Leo Dominguez\":true,\"Kyle Drake\":true,\"Jason Dreyzehner\":true,\"Andre Drommershausen\":true,\"Piotr Drozdek\":true,\"Allwyn Dsouza\":true,\"Christopher Duffill\":true,\"David Dunlap\":true,\"Oliver Egginger\":true,\"Matthew Elias\":true,\"Matt Emery\":true,\"Georg Engelmann\":true,\"Todd Erickson\":true,\"Brittany Erstad\":true,\"James Evans\":true,\"Marco Faasse\":true,\"Eric Falkenstein\":true,\"Joanne Falvey\":true,\"Pascal Feldmann\":true,\"Bruce Fenton\":true,\"Neil Fincham\":true,\"Brad Fire\":true,\"Chris Fisher\":true,\"Daniel Folkinshteyn\":true,\"Thomas Fonseca\":true,\"Adrian Forbes\":true,\"Michael Ford\":true,\"Richard Forsyth\":true,\"Robert Forsyth\":true,\"John Francis\":true,\"Jillian Friedman\":true,\"Michael Fuhrmann\":true,\"Jimmy Furland\":true,\"Neal Gafter\":true,\"John-Paul Gallo\":true,\"Luis Carlos García González\":true,\"Antonio Luis García Navarro\":true,\"Alex Garfinkle\":true,\"Paulo Geyer\":true,\"Adam Gibson\":true,\"Jayton Gill\":true,\"Bryant Joseph Gilot, MD CM DPhil\":true,\"Philip Glover\":true,\"Mike Gogulski\":true,\"Duncan Goldie-Scot\":true,\"Ari Jonathan Goldman\":true,\"Brent Goldman\":true,\"Russ Goodwin\":true,\"Brian Goss\":true,\"Jeffrey Gotts\":true,\"Saurabh Goyal\":true,\"Konrad S. Graf\":true,\"Nick Griffin\":true,\"Johannes Grill\":true,\"Michael Grønager\":true,\"Eric Ying Gu\":true,\"Marina Guryeva\":true,\"Stefan Haderer\":true,\"Oliver Hafner\":true,\"Yoppy Halilintar\":true,\"feng han\":true,\"Larry Han\":true,\"Timo Hanke\":true,\"David Harding\":true,\"Tom Harding\":true,\"Jim Harper\":true,\"Martin Harrigan\":true,\"Quinn Harris\":true,\"Dan Hawrylkiw\":true,\"Mike Hearn\":true,\"David Hellman\":true,\"Kyle Henderson\":true,\"Peter Herrmann\":true,\"Matt Higginson\":true,\"Antonin Hildebrand\":true,\"Charles Hine\":true,\"Andrew Hires\":true,\"Stuart Hoegner\":true,\"Sandro Hogan\":true,\"Claude Hohl\":true,\"Sio Fu Hoi\":true,\"Will Holt\":true,\"Jay Hong\":true,\"Reis Hood\":true,\"Jarrad Hope\":true,\"Matthieu Houriet\":true,\"Ed Howden\":true,\"Huazhou Hu\":true,\"John Huck\":true,\"Jason Hudgins\":true,\"Jason Hughes\":true,\"Richard Hulsebos\":true,\"James Ide\":true,\"Emercor Investment Group\":true,\"Alakanani Itireleng\":true,\"Jean-Marc Jacobson\":true,\"Yaqoob Jamal\":true,\"Yousef Janajri\":true,\"Olivier Janssens\":true,\"David Johnson\":true,\"Eric Johnson\":true,\"Pierre Johnson\":true,\"David Johnston\":true,\"Jp Jones\":true,\"Nathan Jones\":true,\"Paul Jones\":true,\"Christian Kammler\":true,\"David Kaufman\":true,\"Max Kaye\":true,\"Emre Kenci\":true,\"Shakil Khan\":true,\"Jong Hyeop Kim\":true,\"Sehwan Kim\":true,\"Bobby King\":true,\"Brian Klein\":true,\"Masahiro Kobayashi\":true,\"Michael Koloberdin\":true,\"Joseph Ku\":true,\"Aleksander Kucler\":true,\"Zefir Kurtisi\":true,\"Andrew Lampe\":true,\"Alfredo Lapuz Jr.\":true,\"Sterling Ledet\":true,\"Charlie Lee\":true,\"Kevin Lee\":true,\"Andreas Lehrbaum\":true,\"Michael F. Lesser MD\":true,\"Tac Leung\":true,\"Antony Lewis\":true,\"Michael Lewis\":true,\"Bastian Lipp\":true,\"Jim Liu\":true,\"Juan Llanos\":true,\"Sebastian Lobato Genco\":true,\"Scott Loftesness\":true,\"Samuel Lolley\":true,\"Eric Lombrozo\":true,\"Howard Loo\":true,\"Andy Loyd\":true,\"Stephen Macaskill\":true,\"Tj MacIntyre\":true,\"Allen Majewski\":true,\"Hadrien Majoie\":true,\"Meyer \\\"Micky\\\" Malka\":true,\"Leith Marar\":true,\"Dušan Marić\":true,\"Peter Marreck\":true,\"Philippe Martin\":true,\"Ángel José Riesgo Martínez\":true,\"Anthony Matthews\":true,\"Daniel Matuszewski\":true,\"Stephen Mc Namara\":true,\"Seán McCord\":true,\"Gene McCulley\":true,\"Joshua McDougall\":true,\"Joseph McGuire\":true,\"George McHugh\":true,\"Sami Mechkor\":true,\"John Meese\":true,\"Luzius Meisser\":true,\"Steven Merrill\":true,\"Daniel K Mestre\":true,\"Kenneth Metral\":true,\"Mario Micklisch\":true,\"Matt Mihaly\":true,\"Adam Jg Miller\":true,\"Chadwick Miller\":true,\"Derek Miller\":true,\"Damian Minervini\":true,\"Jonathan Mohan\":true,\"Mohammed Mohsin\":true,\"Luis Fernando Molina\":true,\"Cody Moniz\":true,\"Clark Moody\":true,\"Leonardo Mori\":true,\"Spencer Morris\":true,\"Daniel Mross\":true,\"Joseph Mucheru\":true,\"John Muller\":true,\"Dmitry Murashchik\":true,\"Xiao Ning Nan\":true,\"Robert-Reinder Nederhoed\":true,\"Bitcome Network\":true,\"Daniel Nimtsch\":true,\"Cyprien Noel\":true,\"Eric Nydegger\":true,\"KJ O\":true,\"Bergen O\'Brien\":true,\"Dave Olesen\":true,\"Richard Orava\":true,\"Byung \\\"BJay\\\" Pak\":true,\"Richard Pane\":true,\"Marco Pariente-Cohen\":true,\"Frederick Park\":true,\"Dhiren Patel\":true,\"Michael Patryn\":true,\"Mattias Pavlina\":true,\"Patrick Peeters\":true,\"Marcel Pereira\":true,\"Michael Perklin\":true,\"Jonathan Perlow\":true,\"Alex Peterson\":true,\"Andreas Petersson\":true,\"Maxim Petrov\":true,\"Khai Pham\":true,\"Duane Phillippi\":true,\"Piotr Piasecki\":true,\"Brock Pierce\":true,\"Dean Pierce\":true,\"N. Max Pierson\":true,\"Volodymyr Pinchenko\":true,\"Ivan Piramida\":true,\"Elizabeth Ploshay\":true,\"Dario Ponticelli\":true,\"Jay Postma\":true,\"Jesse Powell\":true,\"Dana Powers\":true,\"Peter Pratt\":true,\"Luka Pušić\":true,\"Alexander Putkov\":true,\"Ta\'a Pyland\":true,\"Jeethu Rao\":true,\"Timon Rapp\":true,\"Yurii Rashkovskii\":true,\"Johnathan Reale\":true,\"Jan Rees\":true,\"Thomas Reichhart\":true,\"Michael Reiley\":true,\"Nathan Renich\":true,\"R.J. Raljoseph Ricasata\":true,\"Jp Richardson\":true,\"Chris Rico\":true,\"Stuart Robichaud\":true,\"James Robinson\":true,\"Julian Rodriguez\":true,\"Eric Rogstad\":true,\"Michael Roncone\":true,\"Filip Roose\":true,\"T Steel Rose, CPA\":true,\"Meni Rosenfeld\":true,\"Zackary Ruiz\":true,\"Jean-Pierre Rupp\":true,\"John W Russell\":true,\"Mark Russell\":true,\"Keyvan Sadeghi\":true,\"Leonardo Sagripanti\":true,\"George Sakhel\":true,\"Jez san\":true,\"Gregory Sanders\":true,\"Joseph Sanscrainte\":true,\"Phil Santa-Maria\":true,\"Marco Santori\":true,\"Cynthia Savage\":true,\"Klemen Šavs\":true,\"Martin Schawalder\":true,\"Eric Scheel\":true,\"Derek Scherer\":true,\"Harald Schilly\":true,\"Steven Schram\":true,\"William Seed\":true,\"Ryan Selkis\":true,\"Tom Sensel\":true,\"Dave Seyb\":true,\"Gaurav Sharma\":true,\"Matthew Shaylor\":true,\"Vincent Shi\":true,\"Peter Shiau\":true,\"Zhang Shousong\":true,\"Shamoon Siddiqui\":true,\"Roy Sigler\":true,\"Francesco Simonetti\":true,\"Nick Simpson\":true,\"Martin Sip\":true,\"Lars-Magnus Skog\":true,\"Chris Smelick\":true,\"Christopher Smith\":true,\"Robert Solovay\":true,\"Ryszard Sommefeldt\":true,\"Pengzhan Song\":true,\"Paul Sproge\":true,\"Alan Stanley\":true,\"Howard Stark\":true,\"Guenther Starnberger\":true,\"Dima Starodubcev\":true,\"Randal Stevens\":true,\"Aaron Stranberg\":true,\"Jondale Stratton\":true,\"David Strayhorn\":true,\"Marco Streng\":true,\"Marshall Swatt\":true,\"Matt Tagg\":true,\"Taylor Tan\":true,\"Darren Tapp\":true,\"James Tauber\":true,\"Vadim Telyatnikov\":true,\"Steven The\":true,\"Sheldon Thomas\":true,\"Adam Thorsen\":true,\"Julian Thurston\":true,\"Andrew Tian\":true,\"Wim Timmer\":true,\"Warren Togami\":true,\"Bayan Towfiq\":true,\"Dustin D. Trammell\":true,\"bret treasure\":true,\"Leo Treasure\":true,\"Damien Trog\":true,\"Evan True\":true,\"Jyunfan Tsai\":true,\"Ryan J. Uhr\":true,\"Fernando Ulrich\":true,\"Carsten Unger\":true,\"Sveinn Valfells\":true,\"Renaud Valkenberg\":true,\"Wladimir J. van der Laan\":true,\"Anton van Straaten\":true,\"Roger Ver\":true,\"Simon Vermeersch\":true,\"Laurens Vets\":true,\"Edward Vickery\":true,\"Skid Vis\":true,\"Oleg Voloshin\":true,\"Erik Voorhees\":true,\"Richard Wagner\":true,\"Erv Walter\":true,\"Daniel Wang\":true,\"David Wang\":true,\"Qingyun Wang\":true,\"Xintian Wang\":true,\"Hayden Warnock\":true,\"David Warrilow\":true,\"Nat Wasserstein\":true,\"Derek Watson\":true,\"Dave Weber Jr.\":true,\"Richard Weston\":true,\"Gregory Wexler\":true,\"Alex Wice\":true,\"Shawn Wilkinson\":true,\"Jeff Williams\":true,\"Christopher Wilmer\":true,\"Cody Wilson\":true,\"Scott T Wongsanguan\":true,\"Sebastian Woźniak\":true,\"Craig Wright\":true,\"haisheng wu\":true,\"mingxing xu\":true,\"shuaizhong xu\":true,\"Jonathan Yantis\":true,\"Reuben Yap\":true,\"Robert Yau\":true,\"Harry Yeh\":true,\"Chris Yim\":true,\"Martin Zachrison\":true,\"Kirill Zagalsky\":true,\"Patrick ZAJDA\":true,\"Gustavo Zapico\":true,\"Christopher Zechendorf\":true,\"Dirk Zeitler\":true,\"Jake Zeller\":true,\"Travis Zessin\":true,\"Yudong Zhang\":true,\"Lin Zheming\":true,\"Bruno Zisterer\":true,\"John Zwick\":true,\"Haans\":true,\"Ihar\":true,\"Javier Aanonsen\":true,\"Lucas Aerbeydt\":true,\"Tuomas Ahola\":true,\"Shannon Ainsworth\":true,\"Liza Aizupiete\":true,\"Christopher Akiki\":true,\"Radoslav Albrecht\":true,\"David R. Allen\":true,\"Haiyan Alsaiyed\":true,\"Jose Alvarez Carbajal\":true,\"Fahad Alyhya\":true,\"Andre Amorim\":true,\"Guillaume Amringer\":true,\"Christian Ander\":true,\"Ash Anderson\":true,\"Michael Anderson\":true,\"Mats R. G. Andersson\":true,\"Abelardo Arcos\":true,\"Damian Arenas Newlifeicaro\":true,\"Chris Arnesen\":true,\"Conrad Atherton\":true,\"Halil Ataman Atilkan\":true,\"B B\":true,\"Roy Badami\":true,\"Mildred Bailey\":true,\"Martin Bajalan\":true,\"Alexandru Dan Balan\":true,\"Alex Barbirato\":true,\"Kevin Beardsley\":true,\"Steve Beauregard\":true,\"Adriana Belotti\":true,\"Norman Bench\":true,\"David Berger\":true,\"Pedro Bicudo\":true,\"Fernando Bitti Loureiro\":true,\"Vaughn Blake\":true,\"Daniel Bloch\":true,\"Roman Bock\":true,\"Sascha Boehme\":true,\"Arne Bolen\":true,\"martijn bolt\":true,\"Daromir Bonev\":true,\"Francesco Bonomi\":true,\"Manuel Borrajo\":true,\"Phil Boscarino\":true,\"Grant Bourque\":true,\"Pierre Bourque\":true,\"Paul Boyer\":true,\"Edward Boyle\":true,\"Bryan R. Bradford\":true,\"Pelle Braendgaard\":true,\"Carol Brancato\":true,\"Jose Antonio Bravo Mateu\":true,\"Thierry Bregaint\":true,\"Jerry Brito\":true,\"Alan Bruce\":true,\"Farah Brunache\":true,\"Harvey Brunt\":true,\"Andy Bryant\":true,\"Robert Bufe\":true,\"Michael Bumann\":true,\"Jean-Pierre Buntinx\":true,\"Felix Cabrera\":true,\"Vance Cagle\":true,\"Glenn Callahan\":true,\"Frediano Campione\":true,\"Lucia Cangas\":true,\"Guillermo Carranza\":true,\"Andres Carrero\":true,\"Daniel Carroll\":true,\"Michael Carter\":true,\"Pedro Carvalho\":true,\"malcolm casselle\":true,\"Patrik Čechov\":true,\"Jose Celano\":true,\"danilo cerroni\":true,\"Brett Chang\":true,\"Ryan Charleston\":true,\"Adib Chehade\":true,\"Sergey Chependyuk\":true,\"Igor Chepkasov\":true,\"Chresten Christensen\":true,\"Michael Christensen\":true,\"Chris Chrysostom\":true,\"Jacky Chung\":true,\"James Chung\":true,\"Adam Cleary\":true,\"Stephen Cobb\":true,\"Brian Cohen\":true,\"Justin Cohen\":true,\"Jason Colby\":true,\"Napoleon Cole\":true,\"Shayne Commons\":true,\"Anne Connelly\":true,\"Juan Contreras\":true,\"Adrian Cook\":true,\"Frank Cowan\":true,\"Darold Creel\":true,\"James Criddle\":true,\"lars cridland\":true,\"Marco Crispini\":true,\"Robert Cronk\":true,\"Justina Cruickshank\":true,\"Mark Damstra\":true,\"Tu Danco\":true,\"Zavain Dar\":true,\"Christopher de Beer\":true,\"Devin de Hueck\":true,\"Adrián del Arco Mayor\":true,\"Stephen DeMeuler\":true,\"Daniel DeSousa\":true,\"Patrick Devereaux\":true,\"Dario Di Pardo\":true,\"Joseph Diedrich\":true,\"Lee Dilley\":true,\"Lei Ding\":true,\"Alfred Dixon\":true,\"Bob Dobbs\":true,\"Gabriele Domenichini\":true,\"Erik Doree\":true,\"Shawn Douglass\":true,\"Marcus Downing\":true,\"Romeo Dublin\":true,\"Brendon Duncan\":true,\"Manie Eagar\":true,\"Michael Egidio\":true,\"Jascha Ehrenreich\":true,\"Marius Enache\":true,\"Dion Tyler Endo\":true,\"Marko Eres\":true,\"Augusto Evangelisti\":true,\"Chris Evans\":true,\"Riccardo Faggiana\":true,\"Arthur Falls\":true,\"Justin Fang\":true,\"Mohmaed Amine Faouani\":true,\"Scott Fargo\":true,\"Thibauld Favre\":true,\"Dave Fenrich\":true,\"Brenda Fernández\":true,\"Michele Fiscalini\":true,\"Andy Fletcher\":true,\"Manuel Alejandro Flores Rojas\":true,\"Thomas Forkel\":true,\"Sergij Foski\":true,\"Clément Francomme\":true,\"Christopher Franko\":true,\"Max Frantz\":true,\"Kerry Fraser-Robinson\":true,\"Rob Frees\":true,\"Mathieu Gagnon\":true,\"Colin Gallagher\":true,\"Daniel H. Gallancy\":true,\"Connie Gallippi\":true,\"Kevin Gao\":true,\"David Garcia\":true,\"Domingo García\":true,\"Chad Gardner\":true,\"Jeremy Gardner\":true,\"Cesar Augusto Gaytan Silva\":true,\"Tom Geller\":true,\"david georgette\":true,\"Piotr Giernalczyk\":true,\"Alexandre Gingras\":true,\"Kurt Girdler\":true,\"Eric Goforth\":true,\"Luis Gomez\":true,\"Pablo Gonzalez\":true,\"Robert Gonzalez\":true,\"Arthur Gopak\":true,\"Stanley Gordon\":true,\"Richard Gray\":true,\"Elena Greer\":true,\"Raoul Grosser\":true,\"Chris Gulugian-Taylor\":true,\"Jeff Gunther\":true,\"Andreas Habith\":true,\"Daniel Haigh\":true,\"Costas Halvajoglou\":true,\"Jacob Hansen\":true,\"Kim Hansen\":true,\"Aaron Hanson\":true,\"Daniel Harrison\":true,\"Jon Harvey\":true,\"Xianglong He (何相龙)\":true,\"Brian Heinen\":true,\"Rodrigo Henrik\":true,\"Vincent Herrera\":true,\"Bryan Hilderbrand\":true,\"Rohan Hill\":true,\"Christopher Hindle\":true,\"Aaron Hirsch-Perry\":true,\"Stanley Ho\":true,\"Brian Hoffman\":true,\"Jon Holmquist\":true,\"Charles Hoskinson\":true,\"Barbuleasa Ion\":true,\"P. Faisal Islam\":true,\"Scott Iwamoto\":true,\"Johnathan James\":true,\"LTN Janke\":true,\"John Jardine\":true,\"Christopher Jarmon\":true,\"bart jaspers\":true,\"Cedric Jeanson\":true,\"Jason Jensen\":true,\"Reed Jessen\":true,\"Jean-Francois Jobidon\":true,\"Jennifer Johnson\":true,\"Brendan Johnston\":true,\"Sam Johnston\":true,\"Nihat Karakum\":true,\"John Karanja\":true,\"Gregory Karch\":true,\"Christopher Kaul\":true,\"Scott Keeler\":true,\"Mike Keen\":true,\"Jason Kelly\":true,\"Daniel Kelman\":true,\"Will Kirby\":true,\"Stefan Kliment\":true,\"Brandon Knodel\":true,\"Roland Kofler\":true,\"Matthew Kohen\":true,\"Michi Kono\":true,\"Dmitri Korablev\":true,\"Odi Kosmatos\":true,\"Laurent Kratz\":true,\"Lenny Kugel\":true,\"Sezer Kulac\":true,\"Sergio kulikovsky\":true,\"martin kunert\":true,\"Trevor Laird\":true,\"Marc Laliberte\":true,\"Felipe Lalli\":true,\"Justin Lally\":true,\"Felix Lam\":true,\"Joaquim Lambiza\":true,\"Matthew Larkin\":true,\"Etienne Larrivee\":true,\"Jay Larson\":true,\"Samuel Lay\":true,\"Christopher Lees\":true,\"Miriam Liapi\":true,\"Vince Liem\":true,\"Paul Liggins\":true,\"Magnus Lind\":true,\"Dawn Lindley\":true,\"Vinny Lingham\":true,\"Lily Liu\":true,\"ADVGeneration LLC\":true,\"George Lloyd\":true,\"Jesse Lohse\":true,\"Yannick Losbar\":true,\"Amy Loughran-Dolan\":true,\"Klaus Lovgreen\":true,\"Goldmund Lukich\":true,\"Jordan Lyall\":true,\"Chad MacDonald\":true,\"Edward MacK\":true,\"Christian Maeder\":true,\"Brooke Mallers\":true,\"Ashraf Manasra\":true,\"Samuele Manfrin\":true,\"Juan Manini\":true,\"Miguel A. Manrique Ordax\":true,\"Ivan Marevic\":true,\"Market Marshal\":true,\"Andrew Martin\":true,\"Frederic Martin\":true,\"Rudolph Martin\":true,\"Ryan Martin\":true,\"Pablo Massa\":true,\"Malcolm Matson\":true,\"Marcel Maus\":true,\"David McCabe\":true,\"Felipe McMont\":true,\"Giovanni Meacci\":true,\"Macoy Mejia\":true,\"Konstantin Melnikov\":true,\"Michael Mendez\":true,\"Nicolas Mendoza\":true,\"Brian Merz\":true,\"Hans-Peter Mewes\":true,\"Claudio Migliore\":true,\"Taylor Miles\":true,\"L. Chris Miller\":true,\"Kevin Miniter\":true,\"Taylor Minor\":true,\"Kieron Mitchell\":true,\"Fahim Mohamed\":true,\"Michael Molloy\":true,\"Marcos Antonio Monteiro Carvalho\":true,\"Ivan Montilla\":true,\"Kevin Moore\":true,\"Tony Moore\":true,\"Gabriel Moras\":true,\"Chris Mountford\":true,\"Mohammad Mufti\":true,\"Nicholas Mullesch\":true,\"Victor Muñoz\":true,\"Andrew Murray\":true,\"Nathaniel Murray\":true,\"Nikolai Nauntofte\":true,\"Clay Nelson\":true,\"Lowell Ness\":true,\"nexus aka chus nexusosx86\":true,\"Anders Nielsen\":true,\"Nikolas Nikolaou\":true,\"Mohan Noone\":true,\"Pete Noto\":true,\"Theodore Nwaogu\":true,\"Matt Odell\":true,\"Marcelo Oliveira\":true,\"Juan Matías Olmos\":true,\"Svein Olnes\":true,\"Dusan Oravec\":true,\"Oguz Ozgul\":true,\"Alex Palantzas\":true,\"Christodoulos Panayiotou\":true,\"Adalberto Paredes\":true,\"Michael Parenti\":true,\"Ryan Parker\":true,\"Harsh Patel\":true,\"John Patrick\":true,\"Wade Pedersen\":true,\"Eduardo Pereira (corretorbitcoin)\":true,\"Or Perelman\":true,\"Ricardo Perez Marco\":true,\"Ben Peters\":true,\"Cary Peters\":true,\"Jonny Peters\":true,\"Branden Petersen\":true,\"Todd Pietila\":true,\"Jure Pirc\":true,\"Joshua Plant\":true,\"Jesse Pollak\":true,\"Manuel Polo\":true,\"Victoriano Urbina Porrero\":true,\"Francis Pouliot\":true,\"Adam Poulton\":true,\"Rajeev Prasad\":true,\"David Prince\":true,\"Alex Puig\":true,\"Andrija Pusic\":true,\"Francesco Qualizza\":true,\"Leonard Raimbault\":true,\"Jean-Francois Rajotte\":true,\"Hugo Ramos\":true,\"Luis Alejandro Rangel Sánchez\":true,\"John Ratcliff\":true,\"Stephen Reed\":true,\"Patrick Reilly\":true,\"Sandy Ressler\":true,\"Jacques Reulet\":true,\"Marie-Lynn Richard\":true,\"Stefan Richter\":true,\"Nick Rider\":true,\"Daniel Riehs\":true,\"Leland Riordan\":true,\"Pouya Rismansanj\":true,\"Tyler Robbins\":true,\"Cory Robertson\":true,\"Jamie Robinson\":true,\"Jose Antonio Rodriguez Reyes\":true,\"David Roemer\":true,\"Tanveer Roowala\":true,\"Elizabeth Rossiello\":true,\"Pantelis Roussakis\":true,\"Henry Ruuskanen\":true,\"Steven S\":true,\"Ozgur Murat Sagdicoglu\":true,\"Miguel Angel Salazar Gonzalez\":true,\"Scott Sanderson\":true,\"Fabrizio Santini\":true,\"Zach Saunders\":true,\"Benjamin Sayers\":true,\"Steven Schapiro\":true,\"Monty Schmidt\":true,\"Daan Schröder\":true,\"Nadine Schubert\":true,\"Robert Schwentker\":true,\"Michael Seeley\":true,\"Hari Seldon\":true,\"Aaron Sevivas\":true,\"Nick Shalek\":true,\"Jacob Shapiro\":true,\"Kristoffer Sheather\":true,\"Spencer Sheehan\":true,\"Chris Shepherd\":true,\"Andrew Shin\":true,\"Sergey Shyman\":true,\"Gregory Simon\":true,\"Kawal Singh\":true,\"Geoff Smith\":true,\"Martin Smith\":true,\"Richard Smithers\":true,\"Kristian Soltes\":true,\"Paolo Sommariva\":true,\"Guillem Sorolla\":true,\"Jon Southurst\":true,\"James Spanos\":true,\"Edward Stadum\":true,\"Mary Beth Stanton\":true,\"Patrizio Stavola\":true,\"Robert Stephenson\":true,\"Martin L. Stevenson\":true,\"Mathew Stevenson\":true,\"Peter Stolarski\":true,\"Eric Stromberg\":true,\"Winslow Strong\":true,\"André Stucki\":true,\"John Swabey\":true,\"Mike Sweeney Sweeney\":true,\"Adli TAKKAL BATAILLE\":true,\"Kenichiro Tamura\":true,\"Penelope Taylor\":true,\"Opal Team\":true,\"Libby Thomas\":true,\"Benjamin Thompson\":true,\"Danny Thorpe\":true,\"Jason Tjoeng\":true,\"Bill Togkas\":true,\"Adrian Tomasevic\":true,\"Michael Toomim\":true,\"Roger Townsend\":true,\"Randy Tuler\":true,\"Chris Turlica\":true,\"Andrew Turner\":true,\"S M Monir Uz Zaman\":true,\"Alessandro Valerio\":true,\"Nelz Valero\":true,\"Manuel Van den Eynde\":true,\"Marcel van der Heijden\":true,\"Pepijn van Houwelingen\":true,\"Willem van Oort\":true,\"Gert-Jan van Rooyen\":true,\"Eric Varenhorst\":true,\"Fabian Vasquez\":true,\"Tim Vermeulen\":true,\"Peter Visser\":true,\"Jean Wallemacq\":true,\"Austin Walne\":true,\"Min-Si Wang\":true,\"Violet Watiri\":true,\"Alex Werner\":true,\"Brad Wheeler\":true,\"Joshua Wheelwright\":true,\"Michael Whitehorn\":true,\"Jens Wiechers\":true,\"Piotr Wika\":true,\"Jason Williams\":true,\"Paul Williams\":true,\"Denise m. wlliams\":true,\"John Wnuk\":true,\"Mark Woods\":true,\"Andrei Xydas\":true,\"Che Hao Yang\":true,\"Marty Zigman\":true,\"Franc Zupanec\":true}")

# extras =
#   'adalparedes'
#   'David'


bitcoin_foundation_candidates =
  'Olivier Janssens': true
  'Bruce Fenton': true
  'Dima Starodubcev': true
  'Colin Gallagher': true
  'Scott Morgan': true
  'Theo Chino': true
  'Jim Harper': true
  'Michael Perklin': true
  'Vinny Lingham': true
  'Jeremy Gardner': true
  'Bayan Towfiq': true
  'Francis Pouliot': true
  'Cody Wilson': true

customizations.bitcoin = 

  show_crafting_page_first: true

  hide_home_button_in_proposal_header: true

  HomepageHeader : ReactiveComponent
    displayName: 'HomepageHeader'

    render: ->
      homepage = @root.page_name == 'homepage'
      window.lefty = true

      # Entire header (the grey area)
      DIV
        style:
          backgroundColor: '#676766'
          height: if not homepage then 63
        onMouseEnter: => @local.hover=true;  save(@local)
        onMouseLeave: => @local.hover=false; save(@local)

        STYLE null,
          '''.profile_anchor.login {font-size: 26px; padding-top: 16px;}
             p {margin-bottom: 1em}'''

        # The top bar with the logo
        DIV
          style:
            cursor: if not homepage then 'pointer'
            paddingTop: if homepage then 18 else 17
          onClick: if not homepage then => window.app_router.navigate("/", {trigger: true})

          # Back arrow
          if not homepage
            DIV
              style:
                position: 'absolute'
                left: 20
                top: 0
                color: '#eee'
                fontSize: 43
                fontWeight: 400
                paddingLeft: 25 # Make the clickable target bigger
                width: 180      # Make the clickable target bigger
              '<'

          # Logo
          A
            href: if homepage then 'https://bitcoinfoundation.org'
            IMG
              style:
                height: if homepage then 40 else 26
                marginLeft: if homepage then 82 else 106
              src: "<%= asset_path 'bitcoin/logo.svg' %>"

          if not homepage
            SPAN
              style:
                color: 'cyan'
                fontSize: 26
                fontWeight: 500
                marginLeft: 40
              'The Distributed Opinion'

          # Text
          if homepage
            election_day = new Date('02/13/2015')
            today = new Date()
            _second = 1000
            _minute = _second * 60
            _hour = _minute * 60
            _day = _hour * 24
            days_remaining = Math.ceil((election_day - today) / _day)
            list_style =
              paddingLeft: '1em'
              textIndent: '-1em'
              margin: 0

            DIV
              style:
                paddingLeft: 200
                color: 'white'
                fontSize: 22
                fontWeight: 300
                paddingTop: 23
                paddingBottom: 20
                maxWidth: 915

              DIV
                style:
                  color: 'cyan'
                  fontSize: 63
                  fontWeight: 500
                  marginBottom: 20
                'The Distributed Opinion'

              DIV style: fontWeight: 600, fontSize: 35,
                'Who will you vote for in the Board Election?'

              # P style: marginTop: 20,
              #   "...who are these guys, anyway?"

              P style: marginTop: 20,
                "Figure it out with this "
                SPAN style: fontWeight: 600, 'Distributed Election Guide'
                ".  Like Bitcoin, it's powered by a distributed opinion. Give your opinion to influence other members.  Open a tab to the live "
                A
                  href: 'https://soundcloud.com/mindtomatter/ltb-e186-bitcoin-foundation-2015-candidate-debate'
                  style: textDecoration: 'underline'
                  "audio debate"
                ' while you think.'

              # UL style: margin: 10,
              #   LI style: list_style, 'Weigh in and influence other members'
              #   LI style: list_style, 'Learn what other members think'
              #   LI style: list_style, 'Make your own choice'


              P
                style: margin: '30px 0'
                # 'The public can participate, but only '
                # A
                #   style: textDecoration: 'underline'
                #   href: 'https://bitcoinfoundation.org/members/'
                #   'Foundation Members\''
                # ' opinions appear on the homepage. '

                A
                  href: 'https://blog.bitcoinfoundation.org/elections-update/'
                  style: textDecoration: 'underline', fontWeight: 600
                  "Voting opens in #{days_remaining} day#{if days_remaining==1 then '' else 's'}!"


        ProfileMenu()

  cluster_options :
    # Each cluster can have its own options
    Candidates:   # Options for the "Candidates" cluster
      editor_icons: true
      #homie_histo_filter: (user) -> fetch('ny1').yeah or user.name of bitcoin_foundation_members
      homie_histo_title: "Members' Opinions"
      collapse_descriptions_at: 800

    Debate:       # Options for the "Debate" cluster
      homie_histo_title: "Candidates' Opinions"
      #homie_histo_filter: (user) -> user.name of bitcoin_foundation_candidates
      collapse_descriptions_at: 800



####################
# Bitcoin demo
customizations['bitcoin-demo'] = 
  HomepageHeader : ReactiveComponent
    displayName: 'HomepageHeader'

    render: -> 
      # Background image box
      DIV
        style:
          height: 300
          backgroundImage: "url(<%= asset_path 'bitcoin/bg.jpg' %>)"
          backgroundPosition: 'center'
          backgroundSize: 'cover'

        ProfileMenu()

        # Logo
        IMG
          style: { display: 'block'; margin: 'auto'; height: 150; paddingTop: 45 }
          src: "<%= asset_path 'bitcoin/logo.svg' %>"

        # The word "Demo"
        DIV
          style:
            textAlign: 'center'
            fontWeight: 600
            margin: 'auto'
            fontSize: 24
            color: 'white'
            padding: "10px 0px 0px 60px"
          'demo'


#####################
# Living Voters Guide

customizations.livingvotersguide = 

  Homepage: LearnDecideShareHomepage
  ProposalHeader: StickyProposalHeader

  homepage_heading_columns : [ 
    {heading: 'Learn', details: 'about your ballot'}, \
    {heading: 'Decide', details: 'how you\'ll vote'}, \
    {heading: 'Share', details: 'your opinion'}, \
    {heading: 'Join', details: 'the contributors'}]

  cluster_options : 
    'Advisory votes': 
      description: "* Advisory Votes are not binding. They are a consequence of Initiative 960 passing in 2007"

  ThanksForYourOpinion: ReactiveComponent
    displayName: 'ThanksForYourOpinion'

    render: ->

      if @proposal.category && @proposal.designator
        tweet = "Flex your civic muscle on #{@proposal.category.substring(0,1)}-#{@proposal.designator}! Learn about the issue and decide here: "
      else 
        tweet = "Learn and decide whether you will support \'#{@proposal.name}\' on your Washington ballot here:"
      DIV 
        style: 
          position: 'fixed'
          left: 0
          bottom: 0
          width: '100%'
          backgroundColor: 'rgb(0,182,236)'
          padding: '5px 10px'
          color: 'white'
          zIndex: 999
          textAlign: 'center'
          fontWeight: 600
          fontSize: 18

        'Thanks for your opinion! Invite your friends and family: '
        SPAN style: {position: 'relative', top: 5, marginLeft: 5},
          FBShare()
          Tweet
            text: tweet
            url: "https://livingvotersguide.org/#{@proposal.slug}?results=true"


  HomepageHeader : ReactiveComponent
    displayName: 'HomepageHeader'

    render: ->
      logo_style =
        position: 'absolute'
        left: 40
        top: 11
        width: 252
        zIndex: 1

      DIV className: 'header', 
        STYLE null, 
          """
          .header { height: 275px; background-image: url(<%= asset_path 'livingvotersguide/bg.jpg' %>); background-position: center; background-size: cover; }
          """

        DIV
          style:
            position: 'absolute'
            right: 17
            top: 17
          ProfileMenu({style: {height: 69, left: 0; top: 0, position: 'relative', display: 'inline-block'}})
          SPAN style: {color: 'white'}, '   |   '
          A href:'/about', onClick: clickInternalLink, style: {color: 'white', cursor: 'pointer'},
            'About'
          

        # Logo
        A href: (if @root.page_name == 'homepage' then '/about' else '/'), onClick: clickInternalLink,
          IMG className: 'logo', src: "<%= asset_path 'livingvotersguide/logo.png' %>", style: logo_style

        DIV
          style:
            color: 'white'
            height: 137
            #marginBottom: 10
            clear: 'both'
            paddingTop: 69

          # Online Intelligence for Washington Voters
          DIV
            style:
              fontSize: 32
              padding: '22px 40px 0 332px'
              width: 838
              height: '100%'
              float: 'left'
              fontWeight: 600
            SPAN null, 'Created by the people '
            'and for the people of Washington state'
            DIV
              style: 
                marginBottom: 15
                marginTop: 10
                fontSize: 18
                fontWeight: 300
              "Thanks Washington! We'll see you again in 2015."

          DIV
            style:
              fontSize: 18
              padding: '14px 40px 0 36px'
              float: 'left'
              width: 290
              height: '100%'
            DIV null, 'Hosted by'
            A {href: 'http://seattlecityclub.org'}, B(style:{fontWeight:'bold', color: 'white'}, 'Seattle CityClub')
            DIV style: {marginTop: 8}, 'with fact-checks from'
            A {href: 'http://spl.org'}, B(style:{fontWeight:'bold', color: 'white'}, 'The Seattle Public Library')


  ZipcodeBox : ReactiveComponent
    displayName: 'ZipcodeBox'
    render: ->
      current_user = fetch('/current_user')
      extra_text = if Modernizr.input.placeholder then '' else ' Zip Code'
      onChange = (event) =>
        if event.target.value.match(/\d\d\d\d\d/)
          current_user.tags['zip.editable'] = event.target.value
          save(current_user)

        else if event.target.value.length == 0
          current_user.tags['zip.editable'] = undefined
          @local.stay_around = true
          save(current_user)
          save(@local)

      onBlur = =>
        @local.stay_around = false
        save(@local)

      if current_user.tags['zip.editable'] or @local.stay_around
        STYLE null,
          """
          .filled_zip:hover input, .filled_zip input:focus{
            border: 1px solid #767676;
            background-color: white;}
          """

        # Render the completed zip code box
        DIV 
          className: 'filled_zip'
          style: 
            padding: '13px 23px'
            backgroundColor: '#F5F4ED'
            fontSize: 18
            fontWeight: 400
            width: 245
            margin: 'auto'

          'Customized for:'
          INPUT
            style: 
              fontSize: 18
              fontWeight: 600
              border: '1px solid transparent'
              backgroundColor: 'transparent'
              width: 60
              marginLeft: 7
            type: 'text'
            key: 'zip_input'
            defaultValue: current_user.tags['zip.editable'] or ''
            onChange: onChange
            onBlur: onBlur

      else
        # Render the ragged input box
        DIV style: {margin: '55px 0'},
          DIV 
            style: 
              backgroundImage: 'url(<%= asset_path("greytriangle_up.png") %>)'
              backgroundRepeat: '(repeat-x)'
              backgroundSize: '18px 9px'
              height: 9

          DIV style: {backgroundColor: '#93928E' },
            DIV
              style:
                fontSize: 24
                width: PAGE_WIDTH
                color: 'white'
                margin: 'auto'
                padding: '35px 0'
                paddingLeft: '170px'
              'Customize this guide for your' + extra_text
              INPUT
                type: 'text'
                key: 'zip_input'
                placeholder: 'Zip Code'
                style: {margin: '0 0 0 12px', fontSize: 24, height: 42, width: 152, padding: '4px 20px'}
                onChange: onChange
              BR null
              SPAN style: {fontSize: 18}, 'Your local congressional race and measures will be revealed!'

          DIV 
            style: 
              backgroundImage: 'url(<%= asset_path("greytriangle_down.png") %>)'
              backgroundRepeat: '(repeat-x)'
              backgroundSize: '18px 9px'
              height: 9


  Footer : ReactiveComponent
    displayName: 'Footer'
    render: ->
      DIV 
        style: 
          position: 'relative'
          padding: '2.5em 0 .5em 0'
          textAlign: 'center'

        DIV style: {color: 'white', backgroundColor: '#93928E', marginTop: 48, padding: 18},
          DIV style: {fontSize: 18, fontStyle: 'italic', textAlign: 'left', width: 690, fontStyle: 'italic', margin: 'auto'},
            'Unlike voter guides generated by government, newspapers or advocacy organizations, Living Voters Guide is created '
            SPAN style: {fontWeight: 600}, 'by the people'
            ' and '
            SPAN style: {fontWeight: 600}, 'for the people'
            ' of Washington State. It\'s your platform to learn about candidate and ballot measures, decide how to vote and express your ideas. We believe that sharing our diverse opinions leads to making wiser decisions together. '
            A style: {color: 'white', textDecoration: 'underline', fontWeight: 'normal'}, href: '/about', onClick: clickInternalLink, 'Learn more'
            '.'

          DIV style: {marginTop: 20},
            FBLike()
            Tweet
              hashtags: 'lvguide'
              referer: 'https%3A%2F%2Flivingvotersguide.org%2F'
              related: 'lvguide'
              text: 'I%20flexed%20my%20civic%20muscle%20%40lvguide.'
              url: 'https%3A%2F%2Flivingvotersguide.org%2F'


        DIV style: {paddingTop: 24, paddingBottom: 12, fontSize: 18, fontWeight: 500, color: 'rgb(77,76,71)'},
          'Bug to report? Have a comment? Confused? '
          A href: "mailto:admin@livingvotersguide.org", style: {color: 'rgb(77,76,71)'},
            'Email us'

        DIV style: {paddingBottom: 18},

          DIV style: {textAlign: 'left', padding: '0 12px', color: 'rgb(131,131,131)', display: 'inline-block', fontSize: 15},
            A href: "http://seattlecityclub.org", style: {position: 'relative', top: 3, fontWeight: 400},
              IMG src: "<%= asset_path 'livingvotersguide/cityclub.svg' %>"

          DIV style: {textAlign: 'left', padding: '0 12px', display: 'inline-block', fontSize: 11, position: 'relative', top: -5},
            #"Fact-checking by "
            A href: 'http://spl.org', style: {textTransform: 'uppercase', textDecoration: 'none', color: 'rgb(6, 61, 114)', display: 'block', fontWeight: 600, width: 100}, target: '_blank', 
              'The Seattle Public Library'

        DIV style: {padding: 9},
          TechnologyByConsiderit()


FBShare = ReactiveComponent
  displayName: 'FBShare'

  componentDidMount: ->
    FB.XFBML.parse document

  render: -> 
    layout = 'button'
    SPAN 
      style: {display: 'inline-block', marginRight: 5, position: 'relative', top: -6}
      dangerouslySetInnerHTML: { __html: "<fb:share-button data-layout='#{layout}'></fb:share-button>"}
    

FBLike = ReactiveComponent
  displayName: 'FBLike'
  render : -> 
    page = 'http://www.facebook.com/pages/Living-Voters-Guide/157151824312366'
    IFRAME 
      style: {border: 'none', overflow: 'hidden', width: 90, height: 21}
      src: "//www.facebook.com/plugins/like.php?href=#{page}&send=false&layout=button_count&width=450&show_faces=false&action=like&colorscheme=light&font=lucida+grande&height=21"
      scrolling: "no"
      frameBorder: "0"
      allowTransparency: "true"

Tweet = ReactiveComponent
  displayName: 'Tweet'

  render: ->
    url = "https://platform.twitter.com/widgets/tweet_button.1410542722.html#?_=1410827370943&count=none&id=twitter-widget-0&lang=en&size=m"
    for url_param in ['hashtags', 'original_referer', 'related', 'text', 'url']
      if @props[url_param]
        url += "&#{url_param}=#{@props[url_param]}"

    IFRAME 
      src: url
      scrolling: "no"
      frameBorder: "0"
      allowTransparency: "true"
      className: "twitter-share-button twitter-tweet-button twitter-share-button twitter-count-none"
      style: {width: 57; height: 20}


styles += """
[subdomain="livingvotersguide"] .endorser_group {
  width: 305px;
  display: inline-block;
  margin-bottom: 1em;
  vertical-align: top; }
  [subdomain="livingvotersguide"] .endorser_group.oppose {
    margin-left: 60px; }
  [subdomain="livingvotersguide"] .endorser_group li, [subdomain="livingvotersguide"] .endorser_group a {
    font-size: 12px; }
  [subdomain="livingvotersguide"] .endorser_group ul {
    margin-left: 0px;
    padding-left: 10px; }
[subdomain="livingvotersguide"] .total_money_raised {
  font-weight: 600;
  float: right; }
[subdomain="livingvotersguide"] .funders li {
  list-style: none; }
  [subdomain="livingvotersguide"] .funders li .funder_amount {
    float: right; }
[subdomain="livingvotersguide"] .news {
  padding-left: 0; }
  [subdomain="livingvotersguide"] .news li {
    font-size: 13px;
    list-style: none;
    padding-bottom: 6px; }
[subdomain="livingvotersguide"] .editorials ul {
  padding-left: 10px; }
  [subdomain="livingvotersguide"] .editorials ul li {
    list-style: none;
    padding-top: 6px; }

"""


#####################
# Tigard
customizations.tigard = 
  Homepage: LearnDecideShareHomepage
  ProposalHeader: StickyProposalHeader

  HomepageHeader : ReactiveComponent
    displayName: 'HomepageHeader'

    render: ->
      DIV style: {textAlign: 'center'},
        STYLE null, 
          '.banner_link {color: #78d18b; font-weight: 600; text-decoration: underline;}'

        ProfileMenu()
          
        DIV style: {color: '#707070', fontSize: 32, padding: '20px 0', margin: '0px auto 0 auto', fontWeight: 800, textTransform: 'uppercase', position: 'relative'}, 
          'Help plan '
          A className: 'banner_link', href: 'http://riverterracetigard.com/', 'River Terrace'
          ', Tigard\'s newest neighborhood' 



#####################
# City of Tigard
customizations.cityoftigard = 
  
  HomepageHeader : ReactiveComponent
    displayName: 'HomepageHeader'

    render: -> 
      logo_style = {height: 117, backgroundColor: 'white', borderRight: '2px solid white'}
      DIV style: {backgroundColor: '#253967'},
        ProfileMenu()

        DIV style: {height: 24},
          A href: '/', onClick: clickInternalLink, style: {position: 'absolute', top:0, zIndex: 999999},
            IMG className: 'logo', src: "<%= asset_path 'cityoftigard/logo.png' %>", style: logo_style 
