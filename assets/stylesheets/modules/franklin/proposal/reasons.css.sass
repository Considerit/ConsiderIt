@import "variables"
@import "compass/css3/box-shadow"
@import "compass/css3/transition"
@import "compass/css3/transform"

//////////////////
// global layout for reasons & points, in different states

$use_transitions: true



// transitions / animations
.reasons_layout //.transitioning
  +transition(transform $transition_speed)
  .opinion_region, .community_pros_region, .community_cons_region
    +transition(transform $transition_speed)


// full reasons width is the width of the pro/con list in the middle and the peer pro/con points in the margins
$full_reasons_width: 2 * $decision_board_width + 2
$full_reasons_left: -($full_reasons_width - $content_width) / 2

.reasons_layout  
  &[data-state="results"]
    .opinion_region
      +translateY(- 1.5 * $vertical_baseline)

  &[data-state="crafting"]
    .opinion_region
      +translateY(0)

  // &[data-state="crafting"], &[data-state="summary"]
  //   +translateY(-$histogram_height)

  // &[data-state="crafting"][data-prior-state="results"]
  //   +translateY(0)

  // &[data-state="crafting"][data-prior-state="results"]
  //   // .opinion_region
  //   //   +translateY(- 2 * $vertical_baseline)

  //   // .community_pros_region, .community_cons_region
  //   //   +translateY($vertical_baseline)

  // &[data-state="crafting"][data-prior-state="summary"], &[data-state="crafting"]
  //   // .opinion_region
  //   //   +translateY(3 * $vertical_baseline)

  //   // .community_pros_region, .community_cons_region
  //   //   +translateY(6 * $vertical_baseline)


  // &[data-state="summary"]
  //   // .opinion_region
  //   //   +translateY($histogram_height + $vertical_baseline)


  .community_pros_region .points_by_community
    border-radius: 12px 0 0 12px
    border-right-color: transparent

  .community_cons_region .points_by_community
    border-radius: 0 12px 12px 0
    border-left-color: transparent

  // basic layout

  .points_list_region, .opinion_region
    display: inline-block

  .four_columns_of_points
    //height: 100%
    top: 0 
    min-height: $histogram_height
    // position: absolute  
    position: relative
    margin: auto
    width: $body_width

  .community_pros_region, .community_cons_region
    height: 100%
    margin: $vertical_baseline * 2 0 

    .points_by_community
      padding: 0 1.5 * $grid_gutter
      height: 100%

  .community_pros_region .point_author_avatar
    left: -$point-avatar-width - 14
  .community_cons_region .point_author_avatar
    right: -$point-avatar-width - 14
  &.transitioning .decision_board_points_layout
    //min-height: 0
    min-height: 450px
    height: auto

  &[data-state="crafting"]
    .decision_board_points_layout
      min-height: 450px



  // &[data-state="results"]
  //   .decision_board_points_layout
  //     height: 0
  //     overflow: hidden

  //   .community_pros_region, .community_cons_region
  //     .points_by_community
  //       padding-bottom: 3 * $vertical_baseline

  //horizontal size and positioning
  .four_columns_of_points
    width: $full_reasons_width
    left: $full_reasons_left

  .point_author_avatar
    // width: $point-avatar-width
    position: absolute

  .point_author_avatar, .point_content
    display: inline-block
    vertical-align: top

  .closed_point
    .point_content
      width: $point-content-width

  &[data-state="results"], &[data-state="summary"]

    .community_pros_region
      +translateX($decision_board_width/2)

    .community_cons_region
      +translateX(-$decision_board_width/2)

  .community_pros_region, .community_cons_region
    width: $decision_board_width/2 //$point-width

  .pros_on_decision_board_region, .cons_on_decision_board_region
    width: $point-width


  // expanded points
  &.some_points_are_expanded .four_columns_of_points
    width: $full_reasons_width + $expanded_points_increment

    .opinion_region, .decision_board_layout, .decision_board_body
      height: 100%

  &.con_points_are_expanded .four_columns_of_points
    left: $full_reasons_left - $expanded_points_increment 


  &[data-state="crafting"], &[data-state="results"]
    .community_pros_region, .community_cons_region
      &.points_are_expanded
        width: $decision_board_width/2 + $expanded_points_increment

        .community_point.closed_point 
          //width: $decision_board_width/2 + $expanded_points_increment
          .point_content
            width: $point-content-width + $expanded_points_increment

////////// end layout //////////


// Activity-based styles
[data-activity="proposal-no-activity"]
  .reasons_layout[data-state="summary"] 
    +translateY(0)

    .points_list_region
      //display: none
      height: 0
      overflow: hidden

    // .opinion_region
    //   +translateY(0)

    .four_columns_of_points      
      min-height: 0

  .reasons_layout[data-state="crafting"] 
    .decision_board_points_layout
      min-height: 200px


[data-activity="proposal-has-activity"]
  .reasons_layout[data-state="summary"]
    .four_columns_of_points
      min-height: $histogram_height
      //margin-bottom: 100px // spacing for participants block

  .reasons_layout
    &[data-state="results"], &[data-state="crafting"]
      min-height: 500px

////////////////////


[data-state="summary"] .proposal_reasons_region
  height: 3 * $vertical_baseline

.reasons_layout
  margin: 2.5 * $vertical_baseline 0 4 * $vertical_baseline 0
  position: relative


  &[data-state="summary"] .community_cons_region   
    svg.mouth_bubble
      left: auto
      right: -23px
      
  &[data-state="crafting"], &[data-state="results"], &[data-state="summary"] .community_pros_region
    .points_by_community
      > svg.mouth_bubble
        display: none

  &[data-state="summary"] .points_list_region:hover
    cursor: pointer


  .participating_users_region
    bottom: 0px
    position: absolute
    // width: $body_gutter
    // right: 0

  /////////
  // warpper for a points column, managed by a PointsController
  .points_list_region
    position: relative
    vertical-align: top

  .opinion_region
    // position: relative
    width: $decision_board_width

    &.scrolling_with_user
      position: fixed
      top: 0

  .community_pros_region, .community_cons_region
    //position: absolute
    top: 0
    z-index: 10

  // .pinned .community_cons_region
  //   +transition(none)
  //   +translateX(550px)
  ////////


  /// The participants block
  &[data-state="crafting"]
    > .participating_users_region
      display: none      

  .reasons_footer_region
    visibility: hidden

  &[data-state="summary"] 
    // shown on hover...
    .reasons_footer_region
      width: $body_gutter
      position: absolute
      left: 50%
      margin-left: -$body_gutter/2
      bottom: $vertical_baseline / 4
      cursor: pointer
      z-index: 10

      .results_prompt_from_summary_view
        text-align: center
        +font-size(-1)
        i
          padding-right: $grid_gutter/4

