- name: Initialize production configuration
  template: src=templates/considerit_config/production.rb.j2 dest=$app_home/config/environments/production.rb
  sudo: False

- name: Update gems
  shell: $source && bundle install --gemfile=$app_home/Gemfile && rbenv rehash
  sudo: False

- name: Run database migration
  shell: $source && cd $app_home && RAILS_ENV=$rails_environment bundle exec rake db:migrate
  sudo: False

- name: Precompile assets
  shell: $source && cd $app_home && RAILS_ENV=$rails_environment RAILS_GROUPS=assets bundle exec rake assets:precompile
  ignore_errors: yes #if we don't have AWS S3 set up, asset sync will error out unnecessarily
  sudo: False

- name: Initialize robots.txt
  template: src=templates/robots.txt.j2 dest=$app_home/public/robots.txt
  sudo: False