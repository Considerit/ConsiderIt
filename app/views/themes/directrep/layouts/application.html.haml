
!!! Strict
%html{html_attrs}
  %head{ :profile => "http://gmpg.org/xfn/1" }
    = csrf_meta_tags

    - cache [current_tenant] do 

      %title
        = "#{@title && @title != '' ? @title + " - " : ''}#{current_tenant.app_title}"
            
      %link{ :href => "#{current_theme_image_path 'favicon.ico'}", :rel => "icon", :type => "image/vnd.microsoft.icon" }
      %meta{ :content => 'text/html; charset=UTF-8', "http-equiv" => "Content-Type" }
      
      %meta{ :name => 'keywords', :content => "#{@keywords ? @keywords : ''}"}

      %meta{ :name => 'description', :content => "#{@description ? @description : ''}"}

      %meta{ :name => "google-site-verification", :content => "6nU0cKd6iwc2id7_3fZmOSh7DqxoRGmuOQ4JAye32uQ" }
        
      = theme_stylesheet_link_tag 'application'

      /[if IE 9]
        = stylesheet_link_tag 'ie9'
      
      /[if lte IE 8]
        = stylesheet_link_tag 'ie'

      :javascript
        //http://blog.colin-gourlay.com/blog/2012/02/safely-using-ready-before-including-jquery/
        (function(w,d,u){w.readyQ=[];w.bindReadyQ=[];function p(x,y){if(x=="ready"){w.bindReadyQ.push(y);}else{w.readyQ.push(x);}};var a={ready:p,bind:p};w.$=w.jQuery=function(f){if(f===d||f===u){return a}else{p(f)}}})(window,document)

        $(document).ready(function(){
          sevenUp.plugin.black.test({});      
          ConsiderIt.init(); 
          $(window).bind('page:change', function() {
            ConsiderIt.init();
          });

        });   

      = render :partial => 'backbone/templates'

      = theme_javascript_include_tag 'application', :async => Rails.env.production?

        
      - if APP_CONFIG[:analytics][:google] && APP_CONFIG[:analytics][:google] != ''
        :javascript
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', "#{current_tenant.analytics_google}"]);
          _gaq.push(['_setDomainName', ".#{get_root_domain}"]);
          _gaq.push(['_trackPageview']);


      - if current_tenant.analytics_google && current_tenant.analytics_google != ''
        :javascript
          var _gaq_account = _gaq_account || [];
          _gaq_account.push(['_setAccount', "#{current_tenant.analytics_google}"]);
          _gaq_account.push(['_trackPageview']);
    
    = render :partial => 'backbone/data'

  - theme = Themes::ThemeDirectrep.find_by_account_id(current_tenant.id)
  - cache [current_tenant, theme, @dashboard] do 

    %body
      #wrap{ :class => 'homepage'}
        = render :partial => "shared/flash_messages"
        = render :partial => "shared/header/container"

        #content
          - if Rails.env.development?
            = render :partial => "shared/dev_tools"      

          - if @dashboard
            = render :partial => "dashboard/sidebar"  
          #inner_content
            - rep_user = theme.user

            #homepage
              
              #introduction

                .head.single
                  %h1.banner
                    %span.rep
                      = theme.rep_name
                    %span.dialogue
                      wants to hear from
                    %span.constituency
                      You

                .rep
                  .img
                    = image_tag current_theme_image_path("#{theme.rep_name.gsub(' ', '_').downcase}.jpg")
                  .about
                    = theme.rep_about
                  .links
                    %a
                      website 
                    ★
                    %a
                      twitter
                    ★ 
                    %a
                      facebook

                .dialogue
                  .bubble.rep_statement.left
                    %strong
                      Tell me what you think about the issues below. 
                    I want to be able to represent the residents of Framingham and Ashland well as we consider these issues in the State House. 

                  .bubble.constituent_statement.longer.right
                    Politicians don't care what we think!

                  .clear
                  .bubble.constituent_statement.shorter.right
                    Why should we spend the time?

                  .clear
                  .bubble.rep_statement.left
                    %strong
                      I promise to post a response to your concerns.
                    Your opinions help shape how I look at these important issues for our community. I care what you think.

                .constituency
                  .people  
                    - cols = 6
                    - rows = 8
                    - pics = User.unscoped.where('avatar_file_name IS NOT NULL')
                    - users = pics.sample( [cols*rows, pics.count].min )

                    - users.each do |user|
                      = image_tag image_path(user.avatar.url(:small))

              #proposals
                %ul.proposallist






        = render :partial => "shared/footer/container"
      

