////////////// proposal ////////////
%script{ :type => "text/template", :id => "tpl_proposal_layout" }  

  .proposal-description-region

  .toggle-proposal-state-region
  
  .proposal_histogram_region

  .proposal-reasons-region

%script{ :type => "text/template", :id => "tpl_toggle_proposal_state"}

  (( if(crafting) { ))

  .proposal-state-primary
    {{ call }}

  %a{ :href => "{{Routes.proposal_path( long_id )}}", :class => 'proposal-state-secondary', :'action' => 'view-results'}
    // %i.fa-lg.fa
    //   &#xf046;

    {{ results_call }}

  (( } else { ))
  .proposal-state-primary
    {{ results_call }}

  %a{ :href => "{{Routes.new_opinion_proposal_path( long_id )}}", :class => 'proposal-state-secondary', :'action' => 'craft-opinion'}
    // %i.fa-lg.fa
    //   &#xf096;

    {{ call }}


  (( } ))

////////////// opinion ////////////

%script{ :type => "text/template", :id => "tpl_decision_board_layout" }  

  .decision_board_body 

    .decision-board-heading-region

    .decision-board-points-region

    .slider-region

    .position-explanation-region

  .decision-board-footer-region
              

%script{ :type => "text/template", :id => "tpl_opinion_points" }  

  .pros_on_decision_board-region.points-list-region>     
  .cons_on_decision_board-region.points-list-region>


%script{ :type => "text/template", :id => "tpl_slider" }  
  .slider_heading
    {{ slider_prompt }}
  %table
    %tr
      %td.supporting_slider_label
        %div
          {{ slider_left }}

      %td.slider_container
        .noUiSlider

      %td.opposing_slider_label
        %div
          {{ slider_right }}
    %tr
      %td.neutral_slider_label{ :colspan => 3 }
        {{ slider_middle }}

%script{ :type => "text/template", :id => "tpl_position_explanation" }  
  %label{ :name => :explanation }
    Optional statement that summarizes your thoughts
  %textarea.position-statement{ :name => :explanation}


%script{ :type => "text/template", :id => "tpl_decision_board_footer" }  

  (( if( active ) { ))

  %a.submit_opinion_button.superbutton{:'action' => 'submit-opinion'}
    // fa-floppy-o
    %i.fa-lg.fa.fa-floppy-o
    (( if(updating){ ))
    Update your opinion
    (( } else { ))
    Save your opinion
    (( } ))

  .submit_opinion_footer
    .subscribe_to_proposal_notifications

      = label_tag :follow_proposal, '', :title => 'We\'ll send periodic email notifications summarizing activity on the proposal, as well as alerts about new pro and con points. You can easily unsubscribe later.' do
        
        (( if (follows) { )) 
        = check_box_tag :follow_proposal, 'true', true
        (( } else { ))
        = check_box_tag :follow_proposal, 'true'
        (( }))

        %span
          Get email updates about new activity

    %a.cancel_submitting_an_opinion{:'action' => 'show-results'}
      cancel and show results
  (( } else { ))
  %a.submit_opinion_button.superbutton{:'action' => 'show-results'}
    View results 
  (( } ))


%script{ :type => "text/template", :id => "tpl_decision_board_heading" }  

  (( if(active) { ))
  %a{ :href => "{{Routes.new_opinion_proposal_path( long_id )}}", :'action' => 'craft-opinion'}
    //fa-pencil-square-o
    %i.fa.fa-pencil
    {{ call }}
  (( } ))


%script{ :type => "text/template", :id => "tpl_reasons_layout"}
  .four_columns_of_points
    .community-pros-region.points-list-region>
    .opinion-region>
    .community-cons-region.points-list-region>
  .participating-users-region

  .reasons-footer-region


%script{ :type => "text/template", :id => "tpl_participating_users"}
  (( _.each(participants, function(p){ ))
  %span.avatar{ :'action' => "user_profile_page",  :'data-id' => "{{p.id}}", :alt => "{{p.get('name')}}'s profile picture", :id => "avatar-{{p.id}}", :class => "participant", :style => "height:{{tile_size}}px; width:{{tile_size}}px;"}>
  (( }); ))


%script{ :type => "text/template", :id => "tpl_view_results"}
  %a.view_results_prompt_from_summary{:'action' => 'show-results'}
    //%i.fa.fa-bar-chart-o.fa-lg 
    %i.fa.fa-th-list.fa-lg
    View Results

    
////////////// histogram ////////////


%script{ :type => "text/template", :id => "tpl_histogram_layout"}
  (( if (histogram) { ))
  (( _.each(histogram.breakdown, function(bar){ ))
  .histogram-bar{ :style => "height: {{bar.full_size}}px;", :segment => "{{bar.segment}}", :id => "segment-{{bar.segment}}"}>
    (( if(bar.segment < 4 ){ ))
    = render :partial => "shared/bubble", :locals => {:left => false, :down => true }
    (( } else { ))
    = render :partial => "shared/bubble", :locals => {:left => false, :down => true, :flipped => true }
    (( } ))
    (( if (bar.opinions.length > 0) { ))
    %ul.histogram_bar_users>
      (( _.each(bar.opinions, function(opinion) { ))
      (( var user = opinion.getUser(); ))
      (( if (user){ ))
      (( var has_explanation = opinion.get('explanation') && opinion.get('explanation').length > 0, expl_clss = has_explanation ? 'person-has-explanation' : 'person-has-no-explanation'; ))
      %li.avatar{:class=>"segment-{{bar.segment}} {{expl_clss}}", :'action' => "user_profile_page", :'data-id' => "{{user.id}}", :id => "avatar-{{user.id}}", :alt => "{{user.get('name')}}'s profile picture", :style => "height:{{bar.tile_size}}px; width:{{bar.tile_size}}px;"}>
      (( } ))
      (( }); ))
    (( } ))
  (( }); ))

  .histogram-base
    .histogram-base-label.histogram-base-label-support
      %span
        {{ supporter_label }}
    .histogram-base-label.histogram-base-label-oppose
      %span
        {{ opposer_label }}
  (( } ))


%script{ :type => "text/template", :id => "tpl_proposal_social_media" }
  .social_media_prompt
    Invite your friends to join

  %a{ :href => "https://twitter.com/share", :class => "twitter-share-button", :'data-count' => "none"}
    Tweet
  {{'<' + 'script src="//platform.twitter.com/widgets.js" type="text/javascript"' + '><' + '/script>'}}

  %a.zocial.facebook{ :href => "#", :onclick => "window.open('https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href), 'facebook-share-dialog', 'width=626,height=436'); return false;"}
    Share



%script{ :type => "text/template", :id => "tpl_proposal_admin_strip" }
  (( if(!published){ ))
  .proposal-admin-publish
    = form_for :proposal, :url => "{{Routes.proposal_path(long_id)}}", :method => :put, :remote => true, :html => {:class => 'proposal-publish-form'} do |f|
      = f.hidden_field :published, :value => true

      = f.submit 'Done! Publish it.', :class => 'proposal-publish button'
  (( } ))

  .proposal-admin_strip
    %i.fa-cog.fa

    .proposal-admin-options-menu-wrap
      %ul.proposal-admin-options-menu
        %li.proposal-admin-publicity.l-dialog-prompt
          %a.proposal-admin_operations-publicity.l-dialog-prompt-label
            //Sharing is 
            %span
              (( if(publicity == 2) { ))
              %i.fa.fa-globe
              Accessible to all
              (( } else if(publicity == 1){ ))
              %i.fa.fa-link
              Accessible by link only
              (( } else { ))
              %i.fa.fa-lock
              Accessible by invite only
              (( } ))

        %li.proposal-admin-status.l-dialog-prompt
          %a.proposal-admin_operations-status.l-dialog-prompt-label
            //Status is 
            %span
              (( if(active){ ))
              %i.fa.fa-microphone
              Conversation is Active
              (( } else { ))
              %i.fa.fa-lg.fa-microphone-slash
              Conversation is Closed
              (( } ))

        %li
          (( var call = published ? 'Delete' : 'nevermind, delete it'; ))

          %a.delete_proposal{ :href => "{{Routes.proposal_path(long_id)}}", :'data-confirm' => "Are you sure you wish to permanently delete this conversation?", :'data-method' => 'delete', :'data-remote' => "true", :rel => "nofollow"}
            %i.fa.fa-small.fa-trash-o
            {{call}}

%script{ :type => "text/template", :id => "tpl_proposal_admin_strip_edit_publicity" }

  = form_for :proposal, :url => "{{Routes.proposal_path(long_id)}}", :method => :put, :remote => true, :html => {:class => 'proposal-admin_operations-settings-form'} do |f|
    .radio_block
      .option
        (( if(publicity == 2) { ))
        = f.radio_button :publicity, '2', :value => '2', :checked => true
        (( } else { ))
        = f.radio_button :publicity, '2', :value => '2'
        (( } ))

        %i.fa.fa-globe
        = f.label :publicity, 'Public', :value => '2'
        .sublabel
          It will be listed on the homepage for all visitors.

      .option
        (( if(publicity == 1) { ))
        = f.radio_button :publicity, '1', :value => '1', :checked => true
        (( } else { ))
        = f.radio_button :publicity, '1', :value => '1'
        (( } ))

        %i.fa.fa-link
        = f.label :publicity, 'Anyone with a link', :value => '1'
        .sublabel
          Only people that have a link to this proposal will be able to access it.

      .option
        (( if(publicity == 0) { ))
        = f.radio_button :publicity, '0', :value => '0', :checked => true
        (( } else { ))
        = f.radio_button :publicity, '0', :value => '0'
        (( } ))

        %i.fa.fa-lock
        = f.label :publicity, 'Private', :value => '0'
        .sublabel
          Restrict access to the following comma-separated list of the emails of invited participants.

        .access_list
          = f.text_area :access_list

    .save_block
      = f.submit 'save', :class => 'button'
      %a.cancel{:'action' => "dialog-close"}
        cancel

%script{ :type => "text/template", :id => "tpl_proposal_admin_strip_edit_active"}

  = form_for :proposal, :url => "{{ Routes.proposal_path(long_id) }}", :method => :put, :remote => true, :html => {:class => 'proposal-admin_operations-settings-form'} do |f|
    .radio_block
      .option
        (( if(active) { ))
        = f.radio_button :active, true, :value => true, :checked => true
        (( } else { ))
        = f.radio_button :active, true, :value => true
        (( } ))
        %i.fa.fa-microphone        
        = f.label :active, 'Active', :value => true
        .sublabel
          Contributions are open. People with access to this proposal can contribute to it.
      .option
        (( if(active) { ))
        = f.radio_button :active, false, :value => false
        (( } else { ))
        = f.radio_button :active, false, :value => false, :checked => true
        (( } ))

        %i.fa.fa-lg.fa-microphone-slash

        = f.label :active, 'Read-only', :value => false
        .sublabel
          Contributions are closed. People with access to this proposal will only be able to view it. 

    .save_block
      = f.submit 'save', :class => 'button'
      %a.cancel{:'action' => "dialog-close"}
        cancel